"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('@angular/core');
var router_1 = require('@angular/router');
var dashboard_service_1 = require('./dashboard.service');
var configuration_1 = require('../shared/configuration');
var localStorageService_1 = require('../shared/localStorageService');
var componentCommunicationService_1 = require('../shared/componentCommunicationService');
var ipcSenderService_1 = require('./../shared/ipcSenderService');
var DashboardComponent = (function () {
    function DashboardComponent(router, dashService, localStorageService, ccs, ipcSS) {
        var _this = this;
        this.router = router;
        this.dashService = dashService;
        this.localStorageService = localStorageService;
        this.ccs = ccs;
        this.ipcSS = ipcSS;
        this.comm = { currentState: 'dashboard', isDownloaded: false };
        this.navKind = "content-right";
        this.router = router;
        this.ipcSS = ipcSS;
        this.dashService = dashService;
        this.sortBy = 'REPORT_DUE_DT';
        this.downloadedLocation = [];
        this.isLoading = true;
        this.dashService.getDashboardData().subscribe(function (data) {
            _this.getDashboardDataFromServer = data;
            var dashData = _this.getDashboardDataFromServer;
            if (dashData && dashData.myWorkListResponsePL) {
                var filteredData = _this.filteringDashboardData(dashData.myWorkListResponsePL);
                _this.sites = dashData.myWorkListResponsePL;
            }
            var ipcOperation = {
                "doAction": "saveData",
                "data": data,
                "contentType": 'json',
                "dirRelativePath": '',
                "fileName": "/my-worklist.json"
            };
            _this.ipcSS.ipcAsyncSend(ipcOperation);
        }, function (error) { console.log("error from service"); }, function () { _this.isLoading = false; console.log("job done", _this.getDashboardDataFromServer); });
    }
    DashboardComponent.prototype.filteringDashboardData = function (worklist) {
        var todaysDate = new Date().toISOString();
        for (var i in worklist) {
            if (worklist[i] && worklist[i].REPORT_DUE_DT) {
                worklist[i].repoDateDiff = Math.floor((Date.parse(worklist[i].REPORT_DUE_DT) - Date.parse(todaysDate)) / 86400000) + 1;
                worklist[i].reportDueDiff = this.getDateRange(worklist[i].repoDateDiff);
            }
            if (worklist[i] && worklist[i].SURVEY_START_DT) {
                worklist[i].surveyStartDtDiff = Math.floor((Date.parse(worklist[i].SURVEY_START_DT) - Date.parse(todaysDate)) / 86400000) + 1;
                worklist[i].surveyStartDiff = this.getDateRange(worklist[i].surveyStartDtDiff);
            }
            if (worklist[i] && worklist[i].SURVEY_END_DT) {
                worklist[i].SURVEY_END_DT = this.formatDates(worklist[i].SURVEY_END_DT);
                worklist[i].surveyEndDtDiff = Math.floor((Date.parse(worklist[i].SURVEY_END_DT) - Date.parse(todaysDate)) / 86400000) + 1;
                worklist[i].surveyEndDiff = this.getDateRange(worklist[i].surveyEndDtDiff);
            }
            if (worklist[i] && worklist[i].SURVEY_DUEDATE_TYPE_CD == 'R') {
                worklist[i].displayedSurveyDates = worklist[i].SURVEY_START_DT || null;
            }
            else if (worklist[i] && worklist[i].SURVEY_DUEDATE_TYPE_CD == 'F') {
                worklist[i].displayedSurveyDates = worklist[i].SURVEY_END_DT || null;
            }
            var filePath = worklist[i].RFS_PARENT_ID + '-' + worklist[i].RFS_ID;
            var ipcOperation = {
                "doAction": "isDirExist",
                "dirRelativePath": "/" + filePath
            };
            var dirPath = this.ipcSS.ipcSyncSend(ipcOperation);
            worklist[i].downloadIndicator = dirPath.result == false ? 'F' : 'T';
        }
        this.ccs.setObject(worklist);
        return worklist;
    };
    DashboardComponent.prototype.formatDates = function (d1) {
        var date1;
        var d1Parts = d1.substring(0, 10).split("-");
        date1 = [d1Parts[1], d1Parts[2], d1Parts[0]].join('/');
        date1 = new Date(date1);
        return date1;
    };
    DashboardComponent.prototype.navigate = function (rowData) {
        var locationData = rowData;
        this.localStorageService.set('currState', 'detailspage');
        this.ccs.setSelectedAcc(locationData);
        this.localStorageService.set('locationData', locationData);
        this.localStorageService.removeItem('name');
        this.router.navigate(['/detailspage']);
    };
    DashboardComponent.prototype.toggleSortDrop = function () {
        if (!this.dropopen || this.dropopen == '') {
            this.dropopen = 'open';
        }
        else if (this.dropopen == "open") {
            this.dropopen = '';
        }
        return this.dropopen;
    };
    DashboardComponent.prototype.toggleSortDropClose = function (event) {
        var target = event.target;
        if (!target.closest('.material-icons')) {
            this.dropopen = '';
        }
    };
    DashboardComponent.prototype.sortByCustom = function (value) {
        if (value == 'Report') {
            this.sortBy = 'REPORT_DUE_DT';
        }
        else if (value == 'Survey') {
            this.sortBy = 'displayedSurveyDates';
        }
    };
    DashboardComponent.prototype.downloadedSite = function (site) {
        return site;
    };
    DashboardComponent.prototype.navigateEvent = function (acc) {
        this.ccs.setSelectedAcc(acc);
    };
    DashboardComponent.prototype.getDateRange = function (dayCount) {
        var displayRange;
        dayCount = Number(dayCount);
        if (dayCount == 0) {
            displayRange = 'Today';
        }
        else if (dayCount == 1) {
            displayRange = 'Tomorrow';
        }
        else if (dayCount == -1) {
            displayRange = 'Yesterday';
        }
        else if (dayCount < -1) {
            displayRange = Math.abs(dayCount) + ' days ago';
        }
        else if (dayCount < 8) {
            displayRange = dayCount + ' days';
        }
        else if (dayCount > 7 && dayCount < 15) {
            displayRange = 'week';
        }
        else if (dayCount > 14 && dayCount < 22) {
            displayRange = '2 weeks';
        }
        else if (dayCount > 21 && dayCount < 32) {
            displayRange = '3 weeks';
        }
        else if (dayCount > 31 && dayCount < 62) {
            displayRange = '1 month';
        }
        else if (dayCount > 61 && dayCount < 92) {
            displayRange = '2 months';
        }
        else {
            displayRange = 'Future';
        }
        return displayRange;
    };
    ;
    DashboardComponent.prototype.ngOnInit = function () {
        this.ccs.setLogged(this.comm);
    };
    DashboardComponent.prototype.getSurveyImageId = function (cntr) {
        if (cntr % 5 == 0)
            return 5;
        else
            return cntr % 5;
    };
    DashboardComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'axis-dashboard',
            templateUrl: 'dashboard.component.html',
            styleUrls: ['dasboard.component.css'],
            providers: [dashboard_service_1.DashboardService, configuration_1.Configuration, localStorageService_1.LocalStorageService, ipcSenderService_1.ipcSenderService]
        }), 
        __metadata('design:paramtypes', [router_1.Router, dashboard_service_1.DashboardService, localStorageService_1.LocalStorageService, componentCommunicationService_1.ComponentCommunicationService, ipcSenderService_1.ipcSenderService])
    ], DashboardComponent);
    return DashboardComponent;
}());
exports.DashboardComponent = DashboardComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9kYXNoYm9hcmQvZGFzaGJvYXJkLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBR0EscUJBQWtDLGVBQWUsQ0FBQyxDQUFBO0FBQ2xELHVCQUE2QyxpQkFBaUIsQ0FBQyxDQUFBO0FBQy9ELGtDQUFpQyxxQkFBcUIsQ0FBQyxDQUFBO0FBQ3ZELDhCQUE4Qix5QkFBeUIsQ0FBQyxDQUFBO0FBQ3hELG9DQUFvQywrQkFBK0IsQ0FBQyxDQUFBO0FBQ3BFLDhDQUE4Qyx5Q0FBeUMsQ0FBQyxDQUFBO0FBRXhGLGlDQUFpQyw4QkFBOEIsQ0FBQyxDQUFBO0FBU2hFO0lBWUUsNEJBQW9CLE1BQWMsRUFBVSxXQUE2QixFQUFVLG1CQUF3QyxFQUFTLEdBQWtDLEVBQVUsS0FBdUI7UUFaek0saUJBa0xDO1FBdEtxQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQVUsZ0JBQVcsR0FBWCxXQUFXLENBQWtCO1FBQVUsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUFTLFFBQUcsR0FBSCxHQUFHLENBQStCO1FBQVUsVUFBSyxHQUFMLEtBQUssQ0FBa0I7UUFYL0wsU0FBSSxHQUFnQixFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxDQUFDO1FBQ3hFLFlBQU8sR0FBVyxlQUFlLENBQUM7UUFZdkMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7UUFDL0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxlQUFlLENBQUM7UUFDOUIsSUFBSSxDQUFDLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUV0QixJQUFJLENBQUMsV0FBVyxDQUFDLGdCQUFnQixFQUFFLENBQUMsU0FBUyxDQUMzQyxVQUFBLElBQUk7WUFD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bUIsRUFBRSxtQ0FBZ0IsQ0FBQztTQUNwRixDQUFDOzswQkFBQTtJQW1MRix5QkFBQztBQUFELENBbExBLEFBa0xDLElBQUE7QUFsTFksMEJBQWtCLHFCQWtMOUIsQ0FBQSIsImZpbGUiOiJhcHAvZGFzaGJvYXJkL2Rhc2hib2FyZC5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ3JlYXRlZCBieSBhbmFpciBvbiA5LzE3LzE2LlxyXG4gKi9cclxuaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgUm91dGVyLCBSb3V0ZXMsIFJvdXRlck1vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IERhc2hib2FyZFNlcnZpY2UgfSBmcm9tICcuL2Rhc2hib2FyZC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29uZmlndXJhdGlvbiB9IGZyb20gJy4uL3NoYXJlZC9jb25maWd1cmF0aW9uJztcclxuaW1wb3J0IHsgTG9jYWxTdG9yYWdlU2VydmljZSB9IGZyb20gJy4uL3NoYXJlZC9sb2NhbFN0b3JhZ2VTZXJ2aWNlJztcclxuaW1wb3J0IHsgQ29tcG9uZW50Q29tbXVuaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi9zaGFyZWQvY29tcG9uZW50Q29tbXVuaWNhdGlvblNlcnZpY2UnO1xyXG5pbXBvcnQge0NvbW11bmljYXRlfSBmcm9tICcuLi9zaGFyZWQvY29tcENvbW1JbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBpcGNTZW5kZXJTZXJ2aWNlIH0gZnJvbSAnLi8uLi9zaGFyZWQvaXBjU2VuZGVyU2VydmljZSc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxyXG4gIHNlbGVjdG9yOiAnYXhpcy1kYXNoYm9hcmQnLFxyXG4gIHRlbXBsYXRlVXJsOiAnZGFzaGJvYXJkLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnZGFzYm9hcmQuY29tcG9uZW50LmNzcyddLFxyXG4gIHByb3ZpZGVyczogW0Rhc2hib2FyZFNlcnZpY2UsIENvbmZpZ3VyYXRpb24sIExvY2FsU3RvcmFnZVNlcnZpY2UsIGlwY1NlbmRlclNlcnZpY2VdXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBEYXNoYm9hcmRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIHByaXZhdGUgY29tbTogQ29tbXVuaWNhdGUgPSB7IGN1cnJlbnRTdGF0ZTogJ2Rhc2hib2FyZCcsIGlzRG93bmxvYWRlZDogZmFsc2UgfTtcclxuICBwdWJsaWMgbmF2S2luZDogc3RyaW5nID0gXCJjb250ZW50LXJpZ2h0XCI7XHJcbiAgcHVibGljIGlzTG9hZGluZzogYm9vbGVhbjtcclxuXHJcbiAgZ2V0RGFzaGJvYXJkRGF0YUZyb21TZXJ2ZXI6IEFycmF5PE9iamVjdD47XHJcbiAgZHJvcG9wZW46IGFueTtcclxuICBkb3dubG9hZGVkTG9jYXRpb246IGFueVtdO1xyXG4gIHNvcnRCeTogYW55O1xyXG4gIHNpdGVzOiBhbnk7XHJcbiAgcmZzTWV0YWRhdGE6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByb3V0ZXI6IFJvdXRlciwgcHJpdmF0ZSBkYXNoU2VydmljZTogRGFzaGJvYXJkU2VydmljZSwgcHJpdmF0ZSBsb2NhbFN0b3JhZ2VTZXJ2aWNlOiBMb2NhbFN0b3JhZ2VTZXJ2aWNlLCBwdWJsaWMgY2NzOiBDb21wb25lbnRDb21tdW5pY2F0aW9uU2VydmljZSwgcHJpdmF0ZSBpcGNTUzogaXBjU2VuZGVyU2VydmljZSkge1xyXG4gICAgLy8gICBjb25zdCBzdG9yYWdlID0gcmVxdWlyZSgnZWxlY3Ryb24tc3RvcmFnZScpOyBcclxuICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG4gICAgdGhpcy5pcGNTUyA9IGlwY1NTO1xyXG4gICAgdGhpcy5kYXNoU2VydmljZSA9IGRhc2hTZXJ2aWNlO1xyXG4gICAgdGhpcy5zb3J0QnkgPSAnUkVQT1JUX0RVRV9EVCc7XHJcbiAgICB0aGlzLmRvd25sb2FkZWRMb2NhdGlvbiA9IFtdO1xyXG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgIHRoaXMuZGFzaFNlcnZpY2UuZ2V0RGFzaGJvYXJkRGF0YSgpLnN1YnNjcmliZShcclxuICAgICAgZGF0YSA9PiB7XHJcbiAgICAgICAgdGhpcy5nZXREYXNoYm9hcmREYXRhRnJvbVNlcnZlciA9IGRhdGE7XHJcbiAgICAgICAgbGV0IGRhc2hEYXRhID0gdGhpcy5nZXREYXNoYm9hcmREYXRhRnJvbVNlcnZlcjtcclxuICAgICAgICBpZiAoZGFzaERhdGEgJiYgZGFzaERhdGEubXlXb3JrTGlzdFJlc3BvbnNlUEwpIHtcclxuICAgICAgICAgIHZhciBmaWx0ZXJlZERhdGEgPSB0aGlzLmZpbHRlcmluZ0Rhc2hib2FyZERhdGEoZGFzaERhdGEubXlXb3JrTGlzdFJlc3BvbnNlUEwpO1xyXG4gICAgICAgICAgdGhpcy5zaXRlcyA9IGRhc2hEYXRhLm15V29ya0xpc3RSZXNwb25zZVBMO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gc2F2ZURhdGEgb3BlcmF0aW9uIGV4YW1wbGVcclxuICAgICAgICBsZXQgaXBjT3BlcmF0aW9uID0ge1xyXG4gICAgICAgICAgXCJkb0FjdGlvblwiOiBcInNhdmVEYXRhXCIsXHJcbiAgICAgICAgICBcImRhdGFcIjogZGF0YSxcclxuICAgICAgICAgIFwiY29udGVudFR5cGVcIjogJ2pzb24nLFxyXG4gICAgICAgICAgXCJkaXJSZWxhdGl2ZVBhdGhcIjogJycsIC8vIHdoZW4gbmVlZGVkIHBhc3MgdmFsdWUgd2l0aCBwcmVjZWRpbmcgZm9yd2FyZCBzbGFzaFxyXG4gICAgICAgICAgXCJmaWxlTmFtZVwiOiBcIi9teS13b3JrbGlzdC5qc29uXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuaXBjU1MuaXBjQXN5bmNTZW5kKGlwY09wZXJhdGlvbik7XHJcblxyXG4gICAgICB9LFxyXG4gICAgICBlcnJvciA9PiB7IGNvbnNvbGUubG9nKFwiZXJyb3IgZnJvbSBzZXJ2aWNlXCIpIH0sXHJcbiAgICAgICgpID0+IHsgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsgY29uc29sZS5sb2coXCJqb2IgZG9uZVwiLCB0aGlzLmdldERhc2hib2FyZERhdGFGcm9tU2VydmVyKSB9KTtcclxuXHJcbiAgfVxyXG5cclxuICBmaWx0ZXJpbmdEYXNoYm9hcmREYXRhKHdvcmtsaXN0KSB7XHJcbiAgICBsZXQgdG9kYXlzRGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcclxuICAgIGZvciAobGV0IGkgaW4gd29ya2xpc3QpIHtcclxuICAgICAgaWYgKHdvcmtsaXN0W2ldICYmIHdvcmtsaXN0W2ldLlJFUE9SVF9EVUVfRFQpIHtcclxuICAgICAgICB3b3JrbGlzdFtpXS5yZXBvRGF0ZURpZmYgPSBNYXRoLmZsb29yKChEYXRlLnBhcnNlKHdvcmtsaXN0W2ldLlJFUE9SVF9EVUVfRFQpIC0gRGF0ZS5wYXJzZSh0b2RheXNEYXRlKSkgLyA4NjQwMDAwMCkgKyAxO1xyXG4gICAgICAgIHdvcmtsaXN0W2ldLnJlcG9ydER1ZURpZmYgPSB0aGlzLmdldERhdGVSYW5nZSh3b3JrbGlzdFtpXS5yZXBvRGF0ZURpZmYpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAod29ya2xpc3RbaV0gJiYgd29ya2xpc3RbaV0uU1VSVkVZX1NUQVJUX0RUKSB7XHJcbiAgICAgICAgd29ya2xpc3RbaV0uc3VydmV5U3RhcnREdERpZmYgPSBNYXRoLmZsb29yKChEYXRlLnBhcnNlKHdvcmtsaXN0W2ldLlNVUlZFWV9TVEFSVF9EVCkgLSBEYXRlLnBhcnNlKHRvZGF5c0RhdGUpKSAvIDg2NDAwMDAwKSArIDE7XHJcbiAgICAgICAgd29ya2xpc3RbaV0uc3VydmV5U3RhcnREaWZmID0gdGhpcy5nZXREYXRlUmFuZ2Uod29ya2xpc3RbaV0uc3VydmV5U3RhcnREdERpZmYpO1xyXG4gICAgICB9XHJcbiAgICAgIGlmICh3b3JrbGlzdFtpXSAmJiB3b3JrbGlzdFtpXS5TVVJWRVlfRU5EX0RUKSB7XHJcbiAgICAgICAgd29ya2xpc3RbaV0uU1VSVkVZX0VORF9EVCA9IHRoaXMuZm9ybWF0RGF0ZXMod29ya2xpc3RbaV0uU1VSVkVZX0VORF9EVCk7ICAvLyBERTQ3OlxyXG4gICAgICAgIHdvcmtsaXN0W2ldLnN1cnZleUVuZER0RGlmZiA9IE1hdGguZmxvb3IoKERhdGUucGFyc2Uod29ya2xpc3RbaV0uU1VSVkVZX0VORF9EVCkgLSBEYXRlLnBhcnNlKHRvZGF5c0RhdGUpKSAvIDg2NDAwMDAwKSArIDE7XHJcbiAgICAgICAgd29ya2xpc3RbaV0uc3VydmV5RW5kRGlmZiA9IHRoaXMuZ2V0RGF0ZVJhbmdlKHdvcmtsaXN0W2ldLnN1cnZleUVuZER0RGlmZik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIGdldCB0aGUgc3VydmV5IGRhdGVzIGRpc3BsYXllZCBvbiBVSSBpbnRvIGFuIGFycmF5IHNvIGl0IGNhbiBiZSBzb3J0ZWRcclxuICAgICAgaWYgKHdvcmtsaXN0W2ldICYmIHdvcmtsaXN0W2ldLlNVUlZFWV9EVUVEQVRFX1RZUEVfQ0QgPT0gJ1InKSB7XHJcbiAgICAgICAgd29ya2xpc3RbaV0uZGlzcGxheWVkU3VydmV5RGF0ZXMgPSB3b3JrbGlzdFtpXS5TVVJWRVlfU1RBUlRfRFQgfHwgbnVsbDtcclxuICAgICAgfSBlbHNlIGlmICh3b3JrbGlzdFtpXSAmJiB3b3JrbGlzdFtpXS5TVVJWRVlfRFVFREFURV9UWVBFX0NEID09ICdGJykge1xyXG4gICAgICAgIHdvcmtsaXN0W2ldLmRpc3BsYXllZFN1cnZleURhdGVzID0gd29ya2xpc3RbaV0uU1VSVkVZX0VORF9EVCB8fCBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIGxldCBmaWxlUGF0aCA9IHdvcmtsaXN0W2ldLlJGU19QQVJFTlRfSUQgKyAnLScgKyB3b3JrbGlzdFtpXS5SRlNfSUQ7XHJcbiAgICAgIGxldCBpcGNPcGVyYXRpb24gPSB7XHJcbiAgICAgICAgXCJkb0FjdGlvblwiOiBcImlzRGlyRXhpc3RcIixcclxuICAgICAgICBcImRpclJlbGF0aXZlUGF0aFwiOiBcIi9cIiArIGZpbGVQYXRoXHJcbiAgICAgIH1cclxuICAgICAgbGV0IGRpclBhdGggPSB0aGlzLmlwY1NTLmlwY1N5bmNTZW5kKGlwY09wZXJhdGlvbik7XHJcbiAgICAgIHdvcmtsaXN0W2ldLmRvd25sb2FkSW5kaWNhdG9yID0gZGlyUGF0aC5yZXN1bHQgPT0gZmFsc2UgPyAnRicgOiAnVCc7XHJcbiAgICB9XHJcbiAgICB0aGlzLmNjcy5zZXRPYmplY3Qod29ya2xpc3QpO1xyXG4gICAgcmV0dXJuIHdvcmtsaXN0O1xyXG4gIH1cclxuXHJcbiAgLy8gREU0NzpcclxuICAvLyBCZWxvdyBmdW5jdGlvbiB3YXMgd3JpdHRlbiB0byBkaXNwbGF5IHRoZSBhY3R1YWwgZGF0ZSB0aGF0IGlzIGNvbWluZyBmcm9tIFwibXktd29ya2xpc3RcIiBzZXJ2aWNlLlxyXG4gIC8vIFdoZW5ldmVyIHRoZSBkYXRlIGZvcm1hdCBjb250YWlucyBcIjBcIiBpbW1lZGlhdGVseSBhZnRlciBcIlRcIiBmb3IgZXg6IFwiMjAxNi0xMC0yN1QwMDowMDowMC4wMDBaXCIsIHRoZW5cclxuICAvLyB0aGUgcGlwZSBcIm1lZGl1bURhdGVcIiBpcyBkaXNwbGF5aW5nIGEgZGF0ZSBsZXNzIHRoYW4gdGhlIGFjdHVhbCBkYXRlLiBCZWxvdyBmdW5jdGlvbiBwcmV2ZW50cyB0aGlzLlxyXG4gIGZvcm1hdERhdGVzKGQxKSB7XHJcbiAgICBsZXQgZGF0ZTE6IGFueTtcclxuXHJcbiAgICBsZXQgZDFQYXJ0cyA9IGQxLnN1YnN0cmluZygwLCAxMCkuc3BsaXQoXCItXCIpOyAgICAgICAgICAvLyBZWVlZLU1NLUREXHJcbiAgICBkYXRlMSA9IFtkMVBhcnRzWzFdLCBkMVBhcnRzWzJdLCBkMVBhcnRzWzBdXS5qb2luKCcvJyk7IC8vIE1NL0REL1lZWVlcclxuICAgIGRhdGUxID0gbmV3IERhdGUoZGF0ZTEpO1xyXG5cclxuICAgIHJldHVybiBkYXRlMTtcclxuICB9XHJcblxyXG4gIG5hdmlnYXRlKHJvd0RhdGEpIHtcclxuICAgIGxldCBsb2NhdGlvbkRhdGEgPSByb3dEYXRhO1xyXG4gICAgdGhpcy5sb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnY3VyclN0YXRlJywgJ2RldGFpbHNwYWdlJyk7XHJcbiAgICAvLyAgdGhpcy5jY3Muc2V0TG9nZ2VkKHRoaXMuY29tbSk7XHJcbiAgICB0aGlzLmNjcy5zZXRTZWxlY3RlZEFjYyhsb2NhdGlvbkRhdGEpO1xyXG4gICAgdGhpcy5sb2NhbFN0b3JhZ2VTZXJ2aWNlLnNldCgnbG9jYXRpb25EYXRhJywgbG9jYXRpb25EYXRhKTtcclxuICAgIHRoaXMubG9jYWxTdG9yYWdlU2VydmljZS5yZW1vdmVJdGVtKCduYW1lJyk7XHJcbiAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9kZXRhaWxzcGFnZSddKTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZVNvcnREcm9wKCkge1xyXG4gICAgaWYgKCF0aGlzLmRyb3BvcGVuIHx8IHRoaXMuZHJvcG9wZW4gPT0gJycpIHtcclxuICAgICAgdGhpcy5kcm9wb3BlbiA9ICdvcGVuJztcclxuICAgIH0gZWxzZSBpZiAodGhpcy5kcm9wb3BlbiA9PSBcIm9wZW5cIikge1xyXG4gICAgICB0aGlzLmRyb3BvcGVuID0gJyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5kcm9wb3BlbjtcclxuICB9XHJcblxyXG4gIHRvZ2dsZVNvcnREcm9wQ2xvc2UoZXZlbnQpIHtcclxuICAgIGxldCB0YXJnZXQgPSBldmVudC50YXJnZXQ7XHJcbiAgICBpZiAoIXRhcmdldC5jbG9zZXN0KCcubWF0ZXJpYWwtaWNvbnMnKSkge1xyXG4gICAgICB0aGlzLmRyb3BvcGVuID0gJyc7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzb3J0QnlDdXN0b20odmFsdWUpIHtcclxuICAgIGlmICh2YWx1ZSA9PSAnUmVwb3J0Jykge1xyXG4gICAgICB0aGlzLnNvcnRCeSA9ICdSRVBPUlRfRFVFX0RUJztcclxuICAgIH0gZWxzZSBpZiAodmFsdWUgPT0gJ1N1cnZleScpIHtcclxuICAgICAgdGhpcy5zb3J0QnkgPSAnZGlzcGxheWVkU3VydmV5RGF0ZXMnO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZG93bmxvYWRlZFNpdGUoc2l0ZTogT2JqZWN0KSB7XHJcbiAgICByZXR1cm4gc2l0ZTtcclxuICB9XHJcblxyXG4gIG5hdmlnYXRlRXZlbnQoYWNjOiBPYmplY3QpIHtcclxuICAgIHRoaXMuY2NzLnNldFNlbGVjdGVkQWNjKGFjYyk7XHJcbiAgfVxyXG5cclxuICBnZXREYXRlUmFuZ2UoZGF5Q291bnQpIHtcclxuICAgIGxldCBkaXNwbGF5UmFuZ2U6IGFueTtcclxuICAgIGRheUNvdW50ID0gTnVtYmVyKGRheUNvdW50KTtcclxuICAgIGlmIChkYXlDb3VudCA9PSAwKSB7XHJcbiAgICAgIGRpc3BsYXlSYW5nZSA9ICdUb2RheSc7XHJcbiAgICB9IGVsc2UgaWYgKGRheUNvdW50ID09IDEpIHtcclxuICAgICAgZGlzcGxheVJhbmdlID0gJ1RvbW9ycm93JztcclxuICAgIH0gZWxzZSBpZiAoZGF5Q291bnQgPT0gLTEpIHtcclxuICAgICAgZGlzcGxheVJhbmdlID0gJ1llc3RlcmRheSc7XHJcbiAgICB9IGVsc2UgaWYgKGRheUNvdW50IDwgLTEpIHtcclxuICAgICAgZGlzcGxheVJhbmdlID0gTWF0aC5hYnMoZGF5Q291bnQpICsgJyBkYXlzIGFnbyc7XHJcbiAgICB9IGVsc2UgaWYgKGRheUNvdW50IDwgOCkge1xyXG4gICAgICBkaXNwbGF5UmFuZ2UgPSBkYXlDb3VudCArICcgZGF5cyc7XHJcbiAgICB9IGVsc2UgaWYgKGRheUNvdW50ID4gNyAmJiBkYXlDb3VudCA8IDE1KSB7XHJcbiAgICAgIGRpc3BsYXlSYW5nZSA9ICd3ZWVrJztcclxuICAgIH0gZWxzZSBpZiAoZGF5Q291bnQgPiAxNCAmJiBkYXlDb3VudCA8IDIyKSB7XHJcbiAgICAgIGRpc3BsYXlSYW5nZSA9ICcyIHdlZWtzJztcclxuICAgIH0gZWxzZSBpZiAoZGF5Q291bnQgPiAyMSAmJiBkYXlDb3VudCA8IDMyKSB7XHJcbiAgICAgIGRpc3BsYXlSYW5nZSA9ICczIHdlZWtzJztcclxuICAgIH0gZWxzZSBpZiAoZGF5Q291bnQgPiAzMSAmJiBkYXlDb3VudCA8IDYyKSB7XHJcbiAgICAgIGRpc3BsYXlSYW5nZSA9ICcxIG1vbnRoJztcclxuICAgIH0gZWxzZSBpZiAoZGF5Q291bnQgPiA2MSAmJiBkYXlDb3VudCA8IDkyKSB7XHJcbiAgICAgIGRpc3BsYXlSYW5nZSA9ICcyIG1vbnRocyc7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBkaXNwbGF5UmFuZ2UgPSAnRnV0dXJlJztcclxuICAgIH1cclxuICAgIHJldHVybiBkaXNwbGF5UmFuZ2U7XHJcbiAgfTtcclxuXHJcbiAgbmdPbkluaXQoKSB7XHJcbiAgICB0aGlzLmNjcy5zZXRMb2dnZWQodGhpcy5jb21tKTtcclxuICB9XHJcblxyXG4gIC8vIEdldCBpbWFnZSBzZXF1ZW5jZSBmcm9tIDEtNVxyXG4gIGdldFN1cnZleUltYWdlSWQoY250cikge1xyXG4gICAgaWYgKGNudHIgJSA1ID09IDApXHJcbiAgICAgIHJldHVybiA1O1xyXG4gICAgZWxzZVxyXG4gICAgICByZXR1cm4gY250ciAlIDU7XHJcbiAgfVxyXG59XHJcbiJdfQ==
