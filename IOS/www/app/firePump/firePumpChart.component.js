"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('@angular/core');
var configuration_1 = require('../shared/configuration');
var localStorageService_1 = require('../shared/localStorageService');
var validationMessages_1 = require('../shared/validationMessages');
var FirePumpChartComponent = (function () {
    function FirePumpChartComponent(localStorageService) {
        this.localStorageService = localStorageService;
    }
    FirePumpChartComponent.prototype.showModal = function () {
        this.showChart(this.inputChartData, this.testDataInd);
    };
    FirePumpChartComponent.prototype.hideModal = function () {
        this.modal.hide();
    };
    FirePumpChartComponent.prototype.ngOnInit = function () {
    };
    FirePumpChartComponent.prototype.showChart = function (firePump, testDataInd) {
        this.chartData = [];
        var testData = [];
        var testResults;
        var correctedResults;
        var nominalRated = {
            key: 'Nominal/Rated',
            values: []
        };
        var pOne;
        var pTwo;
        var pThree;
        if (firePump.churnPressure) {
            pOne = {
                x: 0,
                y: Math.round(firePump.churnPressure * 100) / 100
            };
        }
        else {
            pOne = {
                x: 0,
                y: 1.2 * Math.round(firePump.NOMINAL_PUMP_PRESSURE_QT * 100) / 100
            };
        }
        nominalRated.values.push(pOne);
        pTwo = {
            x: Math.round(firePump.NOMINAL_PUMP_FLOW_QT * 100) / 100,
            y: Math.round(firePump.NOMINAL_PUMP_PRESSURE_QT * 100) / 100
        };
        nominalRated.values.push(pTwo);
        if (firePump.maxFlow && firePump.pressureMaxFlow) {
            pThree = {
                x: Math.round(firePump.maxFlow * 100) / 100,
                y: Math.round(firePump.pressureMaxFlow * 100) / 100
            };
        }
        else {
            pThree = {
                x: 1.5 * Math.round(firePump.NOMINAL_PUMP_FLOW_QT * 100) / 100,
                y: 0.65 * Math.round(firePump.NOMINAL_PUMP_PRESSURE_QT * 100) / 100
            };
        }
        nominalRated.values.push(pThree);
        if (firePump.FirePumpPerfList.length > 0) {
            for (var j = 0; j < firePump.FirePumpPerfList.length; j++) {
                if (j == testDataInd && firePump.FirePumpPerfList[j].GRAPH_INCLUSION_IN == true && firePump.FirePumpPerfList[j].FirePumpTestPointsList.length > 0) {
                    testResults = {
                        key: 'Test Results',
                        values: []
                    };
                    correctedResults = {
                        key: 'Corrected Results',
                        values: [],
                        dashed: true
                    };
                    for (var i = 0; i < firePump.FirePumpPerfList[j].FirePumpTestPointsList.length; i++) {
                        var temp = firePump.FirePumpPerfList[j].FirePumpTestPointsList[i];
                        if (temp.MEASURED_FLOW_QT && temp.NET_PRESSURE_QT) {
                            var tr = {
                                x: Math.round(temp.MEASURED_FLOW_QT * 100) / 100,
                                y: Math.round(temp.NET_PRESSURE_QT * 100) / 100
                            };
                            testResults.values.push(tr);
                        }
                        if (temp.CORRECTED_FLOW_QT && temp.CORRECTED_PRESSURE_QT) {
                            var cr = {
                                x: Math.round(temp.CORRECTED_FLOW_QT * 100) / 100,
                                y: Math.round(temp.CORRECTED_PRESSURE_QT * 100) / 100
                            };
                            correctedResults.values.push(cr);
                        }
                    }
                    this.chartData = [testResults, correctedResults, nominalRated];
                }
            }
        }
        var xLabel = 'Flow (' + this.xUnit + ')';
        var yLabel = 'Pressure (' + this.yUnit + ')';
        this.optionsData = {
            chart: {
                type: 'lineChart',
                height: 300,
                width: 900,
                margin: {
                    top: 50,
                    right: 50,
                    bottom: 50,
                    left: 180
                },
                useInteractiveGuideline: true,
                x: function (d) {
                    return d.x;
                },
                y: function (d) {
                    return d.y;
                },
                showValues: true,
                valueFormat: function (d) {
                    return d3.format(',.4f')(d);
                },
                transitionDuration: 500,
                xAxis: {
                    axisLabel: xLabel,
                    tickFormat: function (d) {
                        return d3.format(',2r')(d);
                    },
                },
                yAxis: {
                    axisLabel: yLabel,
                    axisLabelDistance: -10
                }
            }
        };
        this.modal.show();
    };
    __decorate([
        core_1.ViewChild('firePumpChartModal'), 
        __metadata('design:type', core_1.ElementRef)
    ], FirePumpChartComponent.prototype, "modal", void 0);
    FirePumpChartComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'fire-pump-chart',
            templateUrl: 'firePumpChart.component.html',
            providers: [configuration_1.Configuration, localStorageService_1.LocalStorageService, validationMessages_1.ValidationMessages],
            inputs: ['inputChartData', 'testDataInd', 'xUnit', 'yUnit']
        }), 
        __metadata('design:paramtypes', [localStorageService_1.LocalStorageService])
    ], FirePumpChartComponent);
    return FirePumpChartComponent;
}());
exports.FirePumpChartComponent = FirePumpChartComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9maXJlUHVtcC9maXJlUHVtcENoYXJ0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEscUJBQXdFLGVBQWUsQ0FBQyxDQUFBO0FBR3hGLDhCQUE4Qix5QkFBeUIsQ0FBQyxDQUFBO0FBQ3hELG9DQUFvQywrQkFBK0IsQ0FBQyxDQUFBO0FBQ3BFLG1DQUFtQyw4QkFBOEIsQ0FBQyxDQUFBO0FBWWxFO0lBbUJFLGdDQUFvQixtQkFBd0M7UUFBeEMsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtJQUM1RCxDQUFDO0lBVEQsMENBQVMsR0FBVDtRQUNFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELDBDQUFTLEdBQVQ7UUFDRSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3BCLENBQUM7SUFLRCx5Q0FBUSxHQUFSO0lBQ0EsQ0FBQztJQUVELDBDQUFTLEdBQVQsVUFBVSxRQUFRLEVBQUUsV0FBVztRQUM3QixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLFFBQVEsR0FBUSxFQUFFLENBQUM7UUFDdkIsSUFBSSxXQUFnQixDQUFDO1FBQ3JCLElBQUksZ0JBQXFCLENBQUM7UUFDMUIsSUFBSSxZQUFZLEdBQVE7WUFDcEIsR0FBRyxFQUFFLGVBQWU7WUFDcEIsTUFBTSxFQUFFLEVBQUU7U0FDYixDQUFDO1FBQ0YsSUFBSSxJQUFTLENBQUM7UUFDZCxJQUFJLElBQVMsQ0FBQztRQUNkLElBQUksTUFBVyxDQUFDO1FBRWhCLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLElBQUksR0FBRztnQkFDSCxDQUFDLEVBQUUsQ0FBQztnQkFDSixDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsYUFBYSxHQUFH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aUJBQWlCO1lBQzNCLFdBQVcsRUFBRSw4QkFBOEI7WUFDM0MsU0FBUyxFQUFFLENBQUMsNkJBQWEsRUFBRSx5Q0FBbUIsRUFBRSx1Q0FBa0IsQ0FBQztZQUNuRSxNQUFNLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLE9BQU8sQ0FBQztTQUM1RCxDQUFDOzs4QkFBQTtJQWdKRiw2QkFBQztBQUFELENBOUlBLEFBOElDLElBQUE7QUE5SVksOEJBQXNCLHlCQThJbEMsQ0FBQSIsImZpbGUiOiJhcHAvZmlyZVB1bXAvZmlyZVB1bXBDaGFydC5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkLCBFbGVtZW50UmVmLCBJbnB1dCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZPUk1fRElSRUNUSVZFUyAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IE1vZGFsRGlyZWN0aXZlIH0gZnJvbSAnLi4vLi4vc2hhcmVkL21vZGFsL21vZGFsLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IENvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9zaGFyZWQvY29uZmlndXJhdGlvbic7XHJcbmltcG9ydCB7IExvY2FsU3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuLi9zaGFyZWQvbG9jYWxTdG9yYWdlU2VydmljZSc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25NZXNzYWdlcyB9IGZyb20gJy4uL3NoYXJlZC92YWxpZGF0aW9uTWVzc2FnZXMnO1xyXG5pbXBvcnQgeyBDb21tb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2hhcmVkL3NlcnZpY2VzL2NvbW1vbi5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRHJvcGRvd25Db250YWluZXJDb21wb25lbnQgfSBmcm9tICcuLi8uLi9zaGFyZWQvZHJvcGRvd25Db250YWluZXIvZHJvcGRvd24tY29udGFpbmVyLmNvbXBvbmVudCc7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBtb2R1bGVJZDogbW9kdWxlLmlkLFxyXG4gIHNlbGVjdG9yOiAnZmlyZS1wdW1wLWNoYXJ0JywgIFxyXG4gIHRlbXBsYXRlVXJsOiAnZmlyZVB1bXBDaGFydC5jb21wb25lbnQuaHRtbCcsXHJcbiAgcHJvdmlkZXJzOiBbQ29uZmlndXJhdGlvbiwgTG9jYWxTdG9yYWdlU2VydmljZSwgVmFsaWRhdGlvbk1lc3NhZ2VzXSxcclxuICBpbnB1dHM6IFsnaW5wdXRDaGFydERhdGEnLCAndGVzdERhdGFJbmQnLCAneFVuaXQnLCAneVVuaXQnXVxyXG59KVxyXG5cclxuZXhwb3J0IGNsYXNzIEZpcmVQdW1wQ2hhcnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xyXG4gIC8vQElucHV0KCkgaW5wdXRDaGFydERhdGE6IGFueTtcclxuICAvL0BJbnB1dCgpIHRlc3REYXRhSW5kOiBhbnk7XHJcbiAgcHJpdmF0ZSBpbnB1dENoYXJ0RGF0YTogYW55O1xyXG4gIHByaXZhdGUgdGVzdERhdGFJbmQ6IGFueTtcclxuICBwcml2YXRlIHhVbml0OiBhbnk7XHJcbiAgcHJpdmF0ZSB5VW5pdDogYW55O1xyXG4gIHByaXZhdGUgY2hhcnREYXRhOiBhbnk7XHJcbiAgcHJpdmF0ZSBvcHRpb25zRGF0YTogYW55O1xyXG4gIEBWaWV3Q2hpbGQoJ2ZpcmVQdW1wQ2hhcnRNb2RhbCcpIG1vZGFsOkVsZW1lbnRSZWY7XHJcblxyXG4gIHNob3dNb2RhbCgpIHtcclxuICAgIHRoaXMuc2hvd0NoYXJ0KHRoaXMuaW5wdXRDaGFydERhdGEsIHRoaXMudGVzdERhdGFJbmQpO1xyXG4gIH1cclxuXHJcbiAgaGlkZU1vZGFsKCkge1xyXG4gICAgdGhpcy5tb2RhbC5oaWRlKCk7XHJcbiAgfVxyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvY2FsU3RvcmFnZVNlcnZpY2U6IExvY2FsU3RvcmFnZVNlcnZpY2UpIHtcclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gIH0gXHJcblxyXG4gIHNob3dDaGFydChmaXJlUHVtcCwgdGVzdERhdGFJbmQpIHtcclxuICAgIHRoaXMuY2hhcnREYXRhID0gW107XHJcbiAgICBsZXQgdGVzdERhdGE6IGFueSA9IFtdO1xyXG4gICAgbGV0IHRlc3RSZXN1bHRzOiBhbnk7XHJcbiAgICBsZXQgY29ycmVjdGVkUmVzdWx0czogYW55O1xyXG4gICAgbGV0IG5vbWluYWxSYXRlZDogYW55ID0ge1xyXG4gICAgICAgIGtleTogJ05vbWluYWwvUmF0ZWQnLFxyXG4gICAgICAgIHZhbHVlczogW11cclxuICAgIH07XHJcbiAgICBsZXQgcE9uZTogYW55O1xyXG4gICAgbGV0IHBUd286IGFueTtcclxuICAgIGxldCBwVGhyZWU6IGFueTtcclxuXHJcbiAgICBpZihmaXJlUHVtcC5jaHVyblByZXNzdXJlKSB7XHJcbiAgICAgICAgcE9uZSA9IHtcclxuICAgICAgICAgICAgeDogMCxcclxuICAgICAgICAgICAgeTogTWF0aC5yb3VuZChmaXJlUHVtcC5jaHVyblByZXNzdXJlICogMTAwKSAvIDEwMFxyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcE9uZSA9IHtcclxuICAgICAgICAgICAgeDogMCxcclxuICAgICAgICAgICAgeTogMS4yICogTWF0aC5yb3VuZChmaXJlUHVtcC5OT01JTkFMX1BVTVBfUFJFU1NVUkVfUVQgKiAxMDApIC8gMTAwXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgbm9taW5hbFJhdGVkLnZhbHVlcy5wdXNoKHBPbmUpO1xyXG4gICAgcFR3byA9IHtcclxuICAgICAgICB4OiBNYXRoLnJvdW5kKGZpcmVQdW1wLk5PTUlOQUxfUFVNUF9GTE9XX1FUICogMTAwKSAvIDEwMCxcclxuICAgICAgICB5OiBNYXRoLnJvdW5kKGZpcmVQdW1wLk5PTUlOQUxfUFVNUF9QUkVTU1VSRV9RVCAqIDEwMCkgLyAxMDBcclxuICAgIH1cclxuICAgIG5vbWluYWxSYXRlZC52YWx1ZXMucHVzaChwVHdvKTtcclxuICAgIGlmKGZpcmVQdW1wLm1heEZsb3cgJiYgZmlyZVB1bXAucHJlc3N1cmVNYXhGbG93KSB7XHJcbiAgICAgICAgcFRocmVlID0ge1xyXG4gICAgICAgICAgICB4OiBNYXRoLnJvdW5kKGZpcmVQdW1wLm1heEZsb3cgKiAxMDApIC8gMTAwLFxyXG4gICAgICAgICAgICB5OiBNYXRoLnJvdW5kKGZpcmVQdW1wLnByZXNzdXJlTWF4RmxvdyAqIDEwMCkgLyAxMDBcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHBUaHJlZSA9IHtcclxuICAgICAgICAgICAgeDogMS41ICogTWF0aC5yb3VuZChmaXJlUHVtcC5OT01JTkFMX1BVTVBfRkxPV19RVCAqIDEwMCkgLyAxMDAsXHJcbiAgICAgICAgICAgIHk6IDAuNjUgKiBNYXRoLnJvdW5kKGZpcmVQdW1wLk5PTUlOQUxfUFVNUF9QUkVTU1VSRV9RVCAqIDEwMCkgLyAxMDBcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBub21pbmFsUmF0ZWQudmFsdWVzLnB1c2gocFRocmVlKTtcclxuXHJcbiAgICBpZihmaXJlUHVtcC5GaXJlUHVtcFBlcmZMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgZmlyZVB1bXAuRmlyZVB1bXBQZXJmTGlzdC5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICBpZihqID09IHRlc3REYXRhSW5kICYmIGZpcmVQdW1wLkZpcmVQdW1wUGVyZkxpc3Rbal0uR1JBUEhfSU5DTFVTSU9OX0lOID09IHRydWUgJiYgZmlyZVB1bXAuRmlyZVB1bXBQZXJmTGlzdFtqXS5GaXJlUHVtcFRlc3RQb2ludHNMaXN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHRlc3RSZXN1bHRzID0geyBcclxuICAgICAgICAgICAgICAgICAgICBrZXk6ICdUZXN0IFJlc3VsdHMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogW11cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNvcnJlY3RlZFJlc3VsdHMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAga2V5OiAnQ29ycmVjdGVkIFJlc3VsdHMnLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlczogW10sXHJcbiAgICAgICAgICAgICAgICAgICAgZGFzaGVkOiB0cnVlXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZmlyZVB1bXAuRmlyZVB1bXBQZXJmTGlzdFtqXS5GaXJlUHVtcFRlc3RQb2ludHNMaXN0Lmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXAgPSBmaXJlUHVtcC5GaXJlUHVtcFBlcmZMaXN0W2pdLkZpcmVQdW1wVGVzdFBvaW50c0xpc3RbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodGVtcC5NRUFTVVJFRF9GTE9XX1FUICYmIHRlbXAuTkVUX1BSRVNTVVJFX1FUKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQodGVtcC5NRUFTVVJFRF9GTE9XX1FUICogMTAwKSAvIDEwMCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHk6IE1hdGgucm91bmQodGVtcC5ORVRfUFJFU1NVUkVfUVQgKiAxMDApIC8gMTAwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVzdFJlc3VsdHMudmFsdWVzLnB1c2godHIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZih0ZW1wLkNPUlJFQ1RFRF9GTE9XX1FUICYmIHRlbXAuQ09SUkVDVEVEX1BSRVNTVVJFX1FUKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjciA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQodGVtcC5DT1JSRUNURURfRkxPV19RVCAqIDEwMCkgLyAxMDAsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLnJvdW5kKHRlbXAuQ09SUkVDVEVEX1BSRVNTVVJFX1FUICogMTAwKSAvIDEwMFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvcnJlY3RlZFJlc3VsdHMudmFsdWVzLnB1c2goY3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYXJ0RGF0YSA9IFt0ZXN0UmVzdWx0cywgY29ycmVjdGVkUmVzdWx0cywgbm9taW5hbFJhdGVkXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvL3RoaXMuY2hhcnREYXRhLnB1c2godGVzdERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGxldCB4TGFiZWwgPSAnRmxvdyAoJyArIHRoaXMueFVuaXQgKyAnKSc7XHJcbiAgICBsZXQgeUxhYmVsID0gJ1ByZXNzdXJlICgnICsgdGhpcy55VW5pdCArICcpJztcclxuICAgIHRoaXMub3B0aW9uc0RhdGEgPSB7XHJcbiAgICAgICAgY2hhcnQ6IHtcclxuICAgICAgICAgICAgdHlwZTogJ2xpbmVDaGFydCcsXHJcbiAgICAgICAgICAgIGhlaWdodDogMzAwLFxyXG4gICAgICAgICAgICB3aWR0aDogOTAwLFxyXG4gICAgICAgICAgICBtYXJnaW46IHtcclxuICAgICAgICAgICAgICAgIHRvcDogNTAsXHJcbiAgICAgICAgICAgICAgICByaWdodDogNTAsXHJcbiAgICAgICAgICAgICAgICBib3R0b206IDUwLFxyXG4gICAgICAgICAgICAgICAgbGVmdDogMTgwXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHVzZUludGVyYWN0aXZlR3VpZGVsaW5lOiB0cnVlLFxyXG4gICAgICAgICAgICB4OiBmdW5jdGlvbiAoZDogYW55KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZC54O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB5OiBmdW5jdGlvbiAoZDogYW55KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZC55O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzaG93VmFsdWVzOiB0cnVlLFxyXG4gICAgICAgICAgICB2YWx1ZUZvcm1hdDogZnVuY3Rpb24gKGQ6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGQzLmZvcm1hdCgnLC40ZicpKGQpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0cmFuc2l0aW9uRHVyYXRpb246IDUwMCxcclxuICAgICAgICAgICAgeEF4aXM6IHtcclxuICAgICAgICAgICAgICAgIGF4aXNMYWJlbDogeExhYmVsLC8vJ0Zsb3cgKGdwbSknLFxyXG4gICAgICAgICAgICAgICAgdGlja0Zvcm1hdDogZnVuY3Rpb24gKGQ6IGFueSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkMy5mb3JtYXQoJywycicpKGQpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgeUF4aXM6IHtcclxuICAgICAgICAgICAgICAgIGF4aXNMYWJlbDogeUxhYmVsLC8vJ1ByZXNzdXJlIChwc2kpJyxcclxuICAgICAgICAgICAgICAgIGF4aXNMYWJlbERpc3RhbmNlOiAtMTBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHRoaXMubW9kYWwuc2hvdygpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19
