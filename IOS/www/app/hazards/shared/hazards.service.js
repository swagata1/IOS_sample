"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('@angular/core');
var http_1 = require('@angular/http');
require('rxjs/add/operator/map');
var Observable_1 = require('rxjs/Observable');
var configuration_1 = require('../../shared/configuration');
var offline_service_1 = require('../../shared/services/offline.service');
var new_hazard_screen_1 = require('../../shared/model/new-hazard.screen');
var localStorageService_1 = require('../../shared/localStorageService');
var HazardsService = (function () {
    function HazardsService(offlineService, http, configuration, localStorageService) {
        this.offlineService = offlineService;
        this.http = http;
        this.configuration = configuration;
        this.localStorageService = localStorageService;
    }
    HazardsService.prototype.getHazardsData = function (rfsParentId, rfsId) {
        var _this = this;
        return Observable_1.Observable.create(function (observer) {
            _this.offlineService.readLocationData(rfsParentId, rfsId).subscribe(function (data) {
                _this.mapFromLocationData(data).subscribe(function (data) {
                    observer.next(data);
                    observer.complete();
                });
            }, function (err) { return console.error(err); }, function () { });
        });
    };
    HazardsService.prototype.mapToLocationData = function (locationData, hazardsData) {
        data.LocationAssessment.LAWorkPageList[0].Hazards.name = hazardsData.name;
        return locObj;
    };
    HazardsService.prototype.mapFromLocationData = function (locationData) {
        var _this = this;
        return Observable_1.Observable.create(function (observer) {
            var hazardScreen = new new_hazard_screen_1.NewHazardScreen();
            hazardScreen.predominantTS = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.COPE_PAGE.OFFLNS_ORGNL_OCCUPANCY_CD || "";
            hazardScreen.blockName = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].GRASP_LOCATION_NM || "";
            hazardScreen.sicCode = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.COPE_PAGE.SIC_CD || "";
            hazardScreen.tradeSector = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.COPE_PAGE.OCCUPANCY_CD || "";
            _this.localStorageService.set('occupancy_code', hazardScreen.tradeSector);
            hazardScreen.hazardGrade = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.COPE_PAGE.ENGINEERING_HAZARD_GRADE_CD || "";
            hazardScreen.occupancyGroup = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.COPE_PAGE.OCCUPANCY_GROUP_CD || "";
            hazardScreen.hazards = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.OccupancyHazard.HazardList || [];
            hazardScreen.hazardsRatings = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.RatingPage.QuestionCategory || [];
            hazardScreen.riLinks = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.RiskPage.RiskImprvmnt_PAGES || [];
            hazardScreen.hazardList = locationData.LocationAssessment.LAWorkPageList[0].AssessmentLocationList[0].LocAssessment.OccupancyHazard.HazardList || [];
            var observableHazard = _this.getHazardGrades();
            var observableTradeSector = _this.getTradeSectors();
            Observable_1.Observable.forkJoin([observableHazard, observableTradeSector]).subscribe(function (data) {
                var hgObj = data[0].filter(function (item) { return item.HazardGradeCode == hazardScreen.hazardGrade; });
                hazardScreen["hazardGradeDesc"] = hgObj.length > 0 ? hazardScreen.hazardGrade + " - " + hgObj[0].Description : "";
                var tsObj = data[1].filter(function (item) { return item.Code == hazardScreen.tradeSector; });
                hazardScreen["tradeSectorDesc"] = tsObj.length > 0 ? tsObj[0].Description : "";
                var ptsObj = data[1].filter(function (item) { return item.Code == hazardScreen.predominantTS; });
                hazardScreen["predominantTSDesc"] = ptsObj.length > 0 ? ptsObj[0].Description : "";
                observer.next(hazardScreen);
                observer.complete();
            });
        });
    };
    HazardsService.prototype.getHazardGrades = function () {
        return this.http.request("json/reference-data/hazard-grade.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getTradeSectors = function () {
        return this.http.request("json/reference-data/occupancy.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getMainTypeDropdownData = function () {
        return this.http.request("json/reference-data/hazard-main-type.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getClassDropdownData = function () {
        return this.http.request("json/reference-data/others.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getTypeDropdownData = function () {
        return this.http.request("json/reference-data/hazard-type.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getCategoryOccupancyDropdownData = function () {
        return this.http.request("json/reference-data/hazard-category-vs-occupancy.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getSprinklersData = function (rfsParentId, rfsId) {
        var _this = this;
        return Observable_1.Observable.create(function (observer) {
            _this.offlineService.readLocationData(rfsParentId, rfsId).subscribe(function (data) {
                observer.next(data.LocationAssessment.LAWorkPageList[0]);
                observer.complete();
            }, function (err) { return console.error(err); }, function () { });
        });
    };
    HazardsService.prototype.getSprinklersDropdownData = function () {
        return this.http.request("json/reference-data/others.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getRatingAnswers = function () {
        return this.http.request("json/reference-data/rating-answers.json").map(function (res) { return res.json(); });
    };
    HazardsService.prototype.getHazardsRatingCP = function () {
        return this.http.request("json/reference-data/rating-cp.json").map(function (res) { return res.json(); });
    };
    HazardsService = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [offline_service_1.OfflineService, http_1.Http, configuration_1.Configuration, localStorageService_1.LocalStorageService])
    ], HazardsService);
    return HazardsService;
}());
exports.HazardsService = HazardsService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9oYXphcmRzL3NoYXJlZC9oYXphcmRzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHFCQUEyQixlQUFlLENBQUMsQ0FBQTtBQUMzQyxxQkFBK0IsZUFBZSxDQUFDLENBQUE7QUFDL0MsUUFBTyx1QkFBdUIsQ0FBQyxDQUFBO0FBQy9CLDJCQUEyQixpQkFBaUIsQ0FBQyxDQUFBO0FBQzdDLDhCQUE4Qiw0QkFBNEIsQ0FBQyxDQUFBO0FBQzNELGdDQUErQix1Q0FBdUMsQ0FBQyxDQUFBO0FBQ3ZFLGtDQUFnQyxzQ0FBc0MsQ0FBQyxDQUFBO0FBQ3ZFLG9DQUFvQyxrQ0FBa0MsQ0FBQyxDQUFBO0FBR3ZFO0lBRUksd0JBQW9CLGNBQThCLEVBQVUsSUFBVSxFQUFVLGFBQTRCLEVBQVUsbUJBQXdDO1FBQTFJLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUFVLFNBQUksR0FBSixJQUFJLENBQU07UUFBVSxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUFVLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUI7SUFFOUosQ0FBQztJQUVELHVDQUFjLEdBQWQsVUFBZSxXQUFXLEVBQUUsS0FBSztRQUFqQyxpQkFrQkM7UUFqQkcsTUFBTSxDQUFDLHVCQUFVLENBQUMsTUFBTSxDQUFDLFVBQUEsUUFBUTtZQUM3QixLQUFJLENBQUMsY0FBYyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQyxTQUFTLENBRTlELFVBQUEsSUFBSTtnQkFDQSxLQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUNwQyxVQUFBLElBQUk7b0JBQ0EsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDcEIsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUN4QixDQUFDLENBQ0osQ0FBQztZQUNOLENBQUMsRUFFRCxVQUFBLEdBQUcsSUFBSSxPQUFBLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQWxCLENBQWtCLEVBRXpCLGNBQU8sQ0FBQyxDQUNYLENBQUM7UUFDTixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCwwQ0FBaUIsR0FBakIsVUFBa0IsWUFBZ0IsRUFBRSxXQUEyQjtRQUMzRCxJQUFJLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQztRQUUxRSxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2xCLENBQUM7SUFFRCw0Q0FBbUIsR0FBbkIsVUFBb0IsWUFBZ0I7UUFBcEMsaUJBNEJDO1FBM0JHLE1BQU0sQ0FBQyx1QkFBVSxDQUFDLE1BQU0sQ0FBQyxVQUFBLFFBQVE7WUFDN0IsSUFBSSxZQUFZLEdBQUcsSUFBSSxtQ0FBZSxFQUFFLENBQUM7WUFDekMsWUFBWSxDQUFDLGFBQWEsR0FBRyxZQUFZLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMseUJBQXlCLElBQUksRUFBRSxDQUFDO1lBQ2pLLFlBQVksQ0FBQyxTQUFTLEdBQUcsWUFBWSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsSUFBSSxFQUFFLENBQUM7WUFDN0gsWUFBWSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQztZQUN4SSxZQUFZLENBQUMsV0FBVyxHQUFHLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxZQUFZLElBQUksRUFBRSxDQUFDO1lBQ2xKLEtBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsWUFBWSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3pFLFlBQVksQ0FBQyxXQUFXLEdBQUcsWUFBWSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLDJCQUEyQixJQUFJLEVBQUUsQ0FBQztZQUNqSyxZQUFZLENBQUMsY0FBYyxHQUFHLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsSUFBSSxFQUFFLENBQUM7WUFDM0osWUFBWSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQztZQUNsSixZQUFZLENBQUMsY0FBYyxHQUFHLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsSUFBSSxFQUFFLENBQUM7WUFDMUosWUFBWSxDQUFDLE9BQU8sR0FBRyxZQUFZLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLElBQUksRUFBRSxDQUFDO1lBQ25KLFlBQVksQ0FBQyxVQUFVLEdBQUcsWUFBWSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLFVBQVUsSUFBSSxFQUFFLENBQUM7WUFDckosSUFBSSxnQkFBZ0IsR0FBRyxLQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDOUMsSUFBSSxxQkFBcUIsR0FBRyxLQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFFbkQsdUJBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxnQkFBZ0IsRUFBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFVBQUEsSUFBSTtnQkFDeEUsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxlQUFlLElBQUksWUFBWSxDQUFDLFdBQVcsRUFBaEQsQ0FBZ0QsQ0FBQyxDQUFDO2dCQUNyRixZQUFZLENBQUMsaUJBQWlCLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxZQUFZLENBQUMsV0FBVyxHQUFHLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztnQkFDbEgsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxJQUFJLElBQUksWUFBWSxDQUFDLFdBQVcsRUFBckMsQ0FBcUMsQ0FBQyxDQUFDO2dCQUMxRSxZQUFZLENBQUMsaUJBQWlCLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztnQkFDL0UsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxJQUFJLElBQUksWUFBWSxDQUFDLGFBQWEsRUFBdkMsQ0FBdUMsQ0FBQyxDQUFDO2dCQUM3RSxZQUFZLENBQUMsbUJBQW1CLENBQUMsR0FBRyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztnQkFDbkYsUUFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDNUIsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsd0NBQWUsR0FBZjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQVksSUFBSyxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUMsQ0FBQztJQUN4RyxDQUFDO0lBRUQsd0NBQWUsR0FBZjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQVksSUFBSyxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUMsQ0FBQztJQUNyRyxDQUFDO0lBRUQsZ0RBQXVCLEdBQXZCO1FBRUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLDJDQUEyQyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBWSxJQUFLLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0lBQ3pHLENBQUM7SUFFRCw2Q0FBb0IsR0FBcEI7UUFFQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsaUNBQWlDLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFZLElBQUssT0FBQSxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQVYsQ0FBVSxDQUFDLENBQUM7SUFDL0YsQ0FBQztJQUVELDRDQUFtQixHQUFuQjtRQUVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQVksSUFBSyxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUMsQ0FBQztJQUNwRyxDQUFDO0lBRUQseURBQWdDLEdBQWhDO1FBRUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLHVEQUF1RCxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBWSxJQUFLLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0lBQ3JILENBQUM7SUFFRCwwQ0FBaUIsR0FBakIsVUFBa0IsV0FBVyxFQUFFLEtBQUs7UUFBcEMsaUJBY0M7UUFiRyxNQUFNLENBQUMsdUJBQVUsQ0FBQyxNQUFNLENBQUMsVUFBQSxRQUFRO1lBQzdCLEtBQUksQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBQyxDQUFDLFNBQVMsQ0FFOUQsVUFBQSxJQUFJO2dCQUNBLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6RCxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDeEIsQ0FBQyxFQUVELFVBQUEsR0FBRyxJQUFJLE9BQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBbEIsQ0FBa0IsRUFFekIsY0FBTyxDQUFDLENBQ1gsQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELGtEQUF5QixHQUF6QjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEdBQVksSUFBSyxPQUFBLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBVixDQUFVLENBQUMsQ0FBQztJQUNsRyxDQUFDO0lBRUQseUNBQWdCLEdBQWhCO1FBQ0ssTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLHlDQUF5QyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBWSxJQUFLLE9BQUEsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFWLENBQVUsQ0FBQyxDQUFDO0lBQzNHLENBQUM7SUFFRCwyQ0FBa0IsR0FBbEI7UUFDSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsb0NBQW9DLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFhLElBQUssT0FBQSxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQVYsQ0FBVSxDQUFDLENBQUM7SUFDdEcsQ0FBQztJQXJITDtRQUFDLGlCQUFVLEVBQUU7O3NCQUFBO0lBc0hiLHFCQUFDO0FBQUQsQ0FySEEsQUFxSEMsSUFBQTtBQXJIWSxzQkFBYyxpQkFxSDFCLENBQUEiLCJmaWxlIjoiYXBwL2hhemFyZHMvc2hhcmVkL2hhemFyZHMuc2VydmljZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgSHR0cCwgUmVzcG9uc2UgfSBmcm9tICdAYW5ndWxhci9odHRwJztcclxuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9tYXAnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcclxuaW1wb3J0IHsgQ29uZmlndXJhdGlvbiB9IGZyb20gJy4uLy4uL3NoYXJlZC9jb25maWd1cmF0aW9uJztcclxuaW1wb3J0IHsgT2ZmbGluZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zaGFyZWQvc2VydmljZXMvb2ZmbGluZS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgTmV3SGF6YXJkU2NyZWVuIH0gZnJvbSAnLi4vLi4vc2hhcmVkL21vZGVsL25ldy1oYXphcmQuc2NyZWVuJztcclxuaW1wb3J0IHsgTG9jYWxTdG9yYWdlU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9sb2NhbFN0b3JhZ2VTZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIEhhemFyZHNTZXJ2aWNlIHtcclxuICAgXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG9mZmxpbmVTZXJ2aWNlOiBPZmZsaW5lU2VydmljZSwgcHJpdmF0ZSBodHRwOiBIdHRwLCBwcml2YXRlIGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRpb24sIHByaXZhdGUgbG9jYWxTdG9yYWdlU2VydmljZTogTG9jYWxTdG9yYWdlU2VydmljZSl7XHJcbiAgICAgICAgLy8gVGhpcyB3aWxsIGJlIGNvbW1vbiBzZXJ2aWNlIGZvciBhbGwgaGF6YXJkcyBzY3JlZW5zXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0SGF6YXJkc0RhdGEocmZzUGFyZW50SWQsIHJmc0lkKSB7XHJcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKG9ic2VydmVyID0+IHtcclxuICAgICAgICAgICAgdGhpcy5vZmZsaW5lU2VydmljZS5yZWFkTG9jYXRpb25EYXRhKHJmc1BhcmVudElkLCByZnNJZCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgLy8gdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGEgZnVuY3Rpb24gd2hpY2ggcnVucyBvbiBzdWNjZXNzXHJcbiAgICAgICAgICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1hcEZyb21Mb2NhdGlvbkRhdGEoZGF0YSkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgc2Vjb25kIGFyZ3VtZW50IGlzIGEgZnVuY3Rpb24gd2hpY2ggcnVucyBvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSxcclxuICAgICAgICAgICAgICAgIC8vIHRoZSB0aGlyZCBhcmd1bWVudCBpcyBhIGZ1bmN0aW9uIHdoaWNoIHJ1bnMgb24gY29tcGxldGlvblxyXG4gICAgICAgICAgICAgICAgKCkgPT4ge31cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBtYXBUb0xvY2F0aW9uRGF0YShsb2NhdGlvbkRhdGE6YW55LCBoYXphcmRzRGF0YTpOZXdIYXphcmRTY3JlZW4pOiBhbnl7XHJcbiAgICAgICAgZGF0YS5Mb2NhdGlvbkFzc2Vzc21lbnQuTEFXb3JrUGFnZUxpc3RbMF0uSGF6YXJkcy5uYW1lID0gaGF6YXJkc0RhdGEubmFtZTtcclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gbG9jT2JqO1xyXG4gICAgfVxyXG5cclxuICAgIG1hcEZyb21Mb2NhdGlvbkRhdGEobG9jYXRpb25EYXRhOmFueSl7XHJcbiAgICAgICAgcmV0dXJuIE9ic2VydmFibGUuY3JlYXRlKG9ic2VydmVyID0+IHtcclxuICAgICAgICAgICAgbGV0IGhhemFyZFNjcmVlbiA9IG5ldyBOZXdIYXphcmRTY3JlZW4oKTtcclxuICAgICAgICAgICAgaGF6YXJkU2NyZWVuLnByZWRvbWluYW50VFMgPSBsb2NhdGlvbkRhdGEuTG9jYXRpb25Bc3Nlc3NtZW50LkxBV29ya1BhZ2VMaXN0WzBdLkFzc2Vzc21lbnRMb2NhdGlvbkxpc3RbMF0uTG9jQXNzZXNzbWVudC5DT1BFX1BBR0UuT0ZGTE5TX09SR05MX09DQ1VQQU5DWV9DRCB8fCBcIlwiO1xyXG4gICAgICAgICAgICBoYXphcmRTY3JlZW4uYmxvY2tOYW1lID0gbG9jYXRpb25EYXRhLkxvY2F0aW9uQXNzZXNzbWVudC5MQVdvcmtQYWdlTGlzdFswXS5Bc3Nlc3NtZW50TG9jYXRpb25MaXN0WzBdLkdSQVNQX0xPQ0FUSU9OX05NIHx8IFwiXCI7XHJcbiAgICAgICAgICAgIGhhemFyZFNjcmVlbi5zaWNDb2RlID0gbG9jYXRpb25EYXRhLkxvY2F0aW9uQXNzZXNzbWVudC5MQVdvcmtQYWdlTGlzdFswXS5Bc3Nlc3NtZW50TG9jYXRpb25MaXN0WzBdLkxvY0Fzc2Vzc21lbnQuQ09QRV9QQUdFLlNJQ19DRCB8fCBcIlwiO1xyXG4gICAgICAgICAgICBoYXphcmRTY3JlZW4udHJhZGVTZWN0b3IgPSBsb2NhdGlvbkRhdGEuTG9jYXRpb25Bc3Nlc3NtZW50LkxBV29ya1BhZ2VMaXN0WzBdLkFzc2Vzc21lbnRMb2NhdGlvbkxpc3RbMF0uTG9jQXNzZXNzbWVudC5DT1BFX1BBR0UuT0NDVVBBTkNZX0NEIHx8IFwiXCI7XHJcbiAgICAgICAgICAgIHRoaXMubG9jYWxTdG9yYWdlU2VydmljZS5zZXQoJ29jY3VwYW5jeV9jb2RlJywgaGF6YXJkU2NyZWVuLnRyYWRlU2VjdG9yKTtcclxuICAgICAgICAgICAgaGF6YXJkU2NyZWVuLmhhemFyZEdyYWRlID0gbG9jYXRpb25EYXRhLkxvY2F0aW9uQXNzZXNzbWVudC5MQVdvcmtQYWdlTGlzdFswXS5Bc3Nlc3NtZW50TG9jYXRpb25MaXN0WzBdLkxvY0Fzc2Vzc21lbnQuQ09QRV9QQUdFLkVOR0lORUVSSU5HX0hBWkFSRF9HUkFERV9DRCB8fCBcIlwiO1xyXG4gICAgICAgICAgICBoYXphcmRTY3JlZW4ub2NjdXBhbmN5R3JvdXAgPSBsb2NhdGlvbkRhdGEuTG9jYXRpb25Bc3Nlc3NtZW50LkxBV29ya1BhZ2VMaXN0WzBdLkFzc2Vzc21lbnRMb2NhdGlvbkxpc3RbMF0uTG9jQXNzZXNzbWVudC5DT1BFX1BBR0UuT0NDVVBBTkNZX0dST1VQX0NEIHx8IFwiXCI7XHJcbiAgICAgICAgICAgIGhhemFyZFNjcmVlbi5oYXphcmRzID0gbG9jYXRpb25EYXRhLkxvY2F0aW9uQXNzZXNzbWVudC5MQVdvcmtQYWdlTGlzdFswXS5Bc3Nlc3NtZW50TG9jYXRpb25MaXN0WzBdLkxvY0Fzc2Vzc21lbnQuT2NjdXBhbmN5SGF6YXJkLkhhemFyZExpc3QgfHwgW107XHJcbiAgICAgICAgICAgIGhhemFyZFNjcmVlbi5oYXphcmRzUmF0aW5ncyA9IGxvY2F0aW9uRGF0YS5Mb2NhdGlvbkFzc2Vzc21lbnQuTEFXb3JrUGFnZUxpc3RbMF0uQXNzZXNzbWVudExvY2F0aW9uTGlzdFswXS5Mb2NBc3Nlc3NtZW50LlJhdGluZ1BhZ2UuUXVlc3Rpb25DYXRlZ29yeSB8fCBbXTtcclxuICAgICAgICAgICAgaGF6YXJkU2NyZWVuLnJpTGlua3MgPSBsb2NhdGlvbkRhdGEuTG9jYXRpb25Bc3Nlc3NtZW50LkxBV29ya1BhZ2VMaXN0WzBdLkFzc2Vzc21lbnRMb2NhdGlvbkxpc3RbMF0uTG9jQXNzZXNzbWVudC5SaXNrUGFnZS5SaXNrSW1wcnZtbnRfUEFHRVMgfHwgW107ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGhhemFyZFNjcmVlbi5oYXphcmRMaXN0ID0gbG9jYXRpb25EYXRhLkxvY2F0aW9uQXNzZXNzbWVudC5MQVdvcmtQYWdlTGlzdFswXS5Bc3Nlc3NtZW50TG9jYXRpb25MaXN0WzBdLkxvY0Fzc2Vzc21lbnQuT2NjdXBhbmN5SGF6YXJkLkhhemFyZExpc3QgfHwgW107XHJcbiAgICAgICAgICAgIGxldCBvYnNlcnZhYmxlSGF6YXJkID0gdGhpcy5nZXRIYXphcmRHcmFkZXMoKTtcclxuICAgICAgICAgICAgbGV0IG9ic2VydmFibGVUcmFkZVNlY3RvciA9IHRoaXMuZ2V0VHJhZGVTZWN0b3JzKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBPYnNlcnZhYmxlLmZvcmtKb2luKFtvYnNlcnZhYmxlSGF6YXJkLG9ic2VydmFibGVUcmFkZVNlY3Rvcl0pLnN1YnNjcmliZShkYXRhID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBoZ09iaiA9IGRhdGFbMF0uZmlsdGVyKGl0ZW0gPT4gaXRlbS5IYXphcmRHcmFkZUNvZGUgPT0gaGF6YXJkU2NyZWVuLmhhemFyZEdyYWRlKTtcclxuICAgICAgICAgICAgICAgIGhhemFyZFNjcmVlbltcImhhemFyZEdyYWRlRGVzY1wiXSA9IGhnT2JqLmxlbmd0aCA+IDAgPyBoYXphcmRTY3JlZW4uaGF6YXJkR3JhZGUgKyBcIiAtIFwiICsgaGdPYmpbMF0uRGVzY3JpcHRpb24gOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgbGV0IHRzT2JqID0gZGF0YVsxXS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gaGF6YXJkU2NyZWVuLnRyYWRlU2VjdG9yKTtcclxuICAgICAgICAgICAgICAgIGhhemFyZFNjcmVlbltcInRyYWRlU2VjdG9yRGVzY1wiXSA9IHRzT2JqLmxlbmd0aCA+IDAgPyB0c09ialswXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHRzT2JqID0gZGF0YVsxXS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gaGF6YXJkU2NyZWVuLnByZWRvbWluYW50VFMpO1xyXG4gICAgICAgICAgICAgICAgaGF6YXJkU2NyZWVuW1wicHJlZG9taW5hbnRUU0Rlc2NcIl0gPSBwdHNPYmoubGVuZ3RoID4gMCA/IHB0c09ialswXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5uZXh0KGhhemFyZFNjcmVlbik7XHJcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5jb21wbGV0ZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTsgICAgICAgXHJcbiAgICB9ICAgIFxyXG5cclxuICAgIGdldEhhemFyZEdyYWRlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoYGpzb24vcmVmZXJlbmNlLWRhdGEvaGF6YXJkLWdyYWRlLmpzb25gKS5tYXAoKHJlczpSZXNwb25zZSkgPT4gcmVzLmpzb24oKSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGdldFRyYWRlU2VjdG9ycygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoYGpzb24vcmVmZXJlbmNlLWRhdGEvb2NjdXBhbmN5Lmpzb25gKS5tYXAoKHJlczpSZXNwb25zZSkgPT4gcmVzLmpzb24oKSk7ICAgXHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TWFpblR5cGVEcm9wZG93bkRhdGEoKVxyXG4gICAge1xyXG4gICAgXHRyZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoYGpzb24vcmVmZXJlbmNlLWRhdGEvaGF6YXJkLW1haW4tdHlwZS5qc29uYCkubWFwKChyZXM6UmVzcG9uc2UpID0+IHJlcy5qc29uKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldENsYXNzRHJvcGRvd25EYXRhKClcclxuICAgIHtcclxuICAgIFx0cmV0dXJuIHRoaXMuaHR0cC5yZXF1ZXN0KGBqc29uL3JlZmVyZW5jZS1kYXRhL290aGVycy5qc29uYCkubWFwKChyZXM6UmVzcG9uc2UpID0+IHJlcy5qc29uKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFR5cGVEcm9wZG93bkRhdGEoKVxyXG4gICAge1xyXG4gICAgXHRyZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoYGpzb24vcmVmZXJlbmNlLWRhdGEvaGF6YXJkLXR5cGUuanNvbmApLm1hcCgocmVzOlJlc3BvbnNlKSA9PiByZXMuanNvbigpKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZ2V0Q2F0ZWdvcnlPY2N1cGFuY3lEcm9wZG93bkRhdGEoKVxyXG4gICAge1xyXG4gICAgXHRyZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoYGpzb24vcmVmZXJlbmNlLWRhdGEvaGF6YXJkLWNhdGVnb3J5LXZzLW9jY3VwYW5jeS5qc29uYCkubWFwKChyZXM6UmVzcG9uc2UpID0+IHJlcy5qc29uKCkpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFNwcmlua2xlcnNEYXRhKHJmc1BhcmVudElkLCByZnNJZCkge1xyXG4gICAgICAgIHJldHVybiBPYnNlcnZhYmxlLmNyZWF0ZShvYnNlcnZlciA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMub2ZmbGluZVNlcnZpY2UucmVhZExvY2F0aW9uRGF0YShyZnNQYXJlbnRJZCwgcmZzSWQpLnN1YnNjcmliZShcclxuICAgICAgICAgICAgICAgIC8vIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBhIGZ1bmN0aW9uIHdoaWNoIHJ1bnMgb24gc3VjY2Vzc1xyXG4gICAgICAgICAgICAgICAgZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dChkYXRhLkxvY2F0aW9uQXNzZXNzbWVudC5MQVdvcmtQYWdlTGlzdFswXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAvLyB0aGUgc2Vjb25kIGFyZ3VtZW50IGlzIGEgZnVuY3Rpb24gd2hpY2ggcnVucyBvbiBlcnJvclxyXG4gICAgICAgICAgICAgICAgZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKSxcclxuICAgICAgICAgICAgICAgIC8vIHRoZSB0aGlyZCBhcmd1bWVudCBpcyBhIGZ1bmN0aW9uIHdoaWNoIHJ1bnMgb24gY29tcGxldGlvblxyXG4gICAgICAgICAgICAgICAgKCkgPT4ge31cclxuICAgICAgICAgICAgKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTcHJpbmtsZXJzRHJvcGRvd25EYXRhKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChganNvbi9yZWZlcmVuY2UtZGF0YS9vdGhlcnMuanNvbmApLm1hcCgocmVzOlJlc3BvbnNlKSA9PiByZXMuanNvbigpKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXRSYXRpbmdBbnN3ZXJzKCl7XHJcbiAgICAgICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdChganNvbi9yZWZlcmVuY2UtZGF0YS9yYXRpbmctYW5zd2Vycy5qc29uYCkubWFwKChyZXM6UmVzcG9uc2UpID0+IHJlcy5qc29uKCkpOyAgIFxyXG4gICAgfVxyXG5cclxuICAgIGdldEhhemFyZHNSYXRpbmdDUCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoYGpzb24vcmVmZXJlbmNlLWRhdGEvcmF0aW5nLWNwLmpzb25gKS5tYXAoKHJlczogUmVzcG9uc2UpID0+IHJlcy5qc29uKCkpO1xyXG4gICAgfVxyXG59Il19
