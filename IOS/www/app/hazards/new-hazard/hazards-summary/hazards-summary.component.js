"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('@angular/core');
var common_1 = require('@angular/common');
var componentCommunicationService_1 = require('../../../shared/componentCommunicationService');
var localStorageService_1 = require('../../../shared/localStorageService');
var validationMessages_1 = require('../../../shared/validationMessages');
var event_model_1 = require('../../../shared/model/event.model');
var offline_service_1 = require('../../../shared/services/offline.service');
var hazards_service_1 = require('../../shared/hazards.service');
var location_data_model_1 = require('../../../shared/model/location-data.model');
var HazardsSummaryComponent = (function () {
    function HazardsSummaryComponent(hazardsService, offlineService, ccs, localStorageService) {
        this.hazardsService = hazardsService;
        this.offlineService = offlineService;
        this.ccs = ccs;
        this.localStorageService = localStorageService;
        this.occupancy_cd = 2;
        this.mainTypeDrop = [];
        this.typeDrop = [];
        this.categoryDesc = [];
    }
    HazardsSummaryComponent.prototype.ngOnInit = function () {
        var _this = this;
        this.site = this.localStorageService.get('locationData');
        this.getOccupancyData();
        if (this.viewType && this.viewType == 'small')
            this.hazardsSummarySmallView = true;
        this.getData();
        this.ccs.getHazardAddData().subscribe(function (data) {
            if (data.state == "New") {
                _this.categoryDesc = [];
                _this.mainTypeDrop = [];
                _this.typeDrop = [];
                _this.hazardAddDataObj = data.hazardObj;
                _this.hazardsSummary.push(_this.hazardAddDataObj);
                for (var i = 0; i < _this.hazardsSummary.length; i++) {
                    var a = _this.mainType.filter(function (item) { return item.Code == _this.hazardsSummary[i].HAZARD_MAIN_TYPE_CD; });
                    var maintype = a.length > 0 ? a[0].Description : "";
                    _this.mainTypeDrop.push(maintype);
                }
                for (var i = 0; i < _this.hazardsSummary.length; i++) {
                    var b = _this.type.filter(function (item) { return item.Code == _this.hazardsSummary[i].HAZARD_TYPE_CD; });
                    var type = b.length > 0 ? b[0].Description : "";
                    _this.typeDrop.push(type);
                }
                for (var i = 0; i < _this.hazardsSummary.length; i++) {
                    var c = _this.catOccData.filter(function (item) { return item.ELEMENT_CD == _this.hazardsSummary[i].HAZARD_CATEGORY_CD; });
                    var categoryDescription = c.length > 0 ? c[0].Description : "";
                    _this.categoryDesc.push(categoryDescription);
                }
                data.state = "";
            }
            else if (data.state == "Update") {
                _this.hazardsSummary[data.index] = data.hazardObj;
                var a = _this.mainType.filter(function (item) { return item.Code == _this.hazardsSummary[data.index].HAZARD_MAIN_TYPE_CD; });
                var maintype = a.length > 0 ? a[0].Description : "";
                _this.mainTypeDrop[data.index] = maintype;
                var b = _this.type.filter(function (item) { return item.Code == _this.hazardsSummary[data.index].HAZARD_TYPE_CD; });
                var type = b.length > 0 ? b[0].Description : "";
                _this.typeDrop[data.index] = type;
                var c = _this.catOccData.filter(function (item) { return item.ELEMENT_CD == _this.hazardsSummary[data.index].HAZARD_CATEGORY_CD; });
                var categoryDescription = c.length > 0 ? c[0].Description : "";
                _this.categoryDesc[data.index] = categoryDescription;
                data.state = "";
            }
        });
        this.ccs.getHazardsData().subscribe(function (data) {
            _this.setHazardsSummaryObject(data);
        });
        this.saveInterval = setInterval(function () {
            console.log("Requesting wind peril to save for rfs parent:", _this.site.RFS_PARENT_ID, "and rfs:", _this.site.RFS_ID);
            _this.saveDataToFile(new event_model_1.Event(_this.site.RFS_PARENT_ID, _this.site.RFS_ID, 'save'));
        }, 30000);
    };
    HazardsSummaryComponent.prototype.ngOnDestroy = function () {
        if (this.saveInterval) {
            clearInterval(this.saveInterval);
            this.saveDataToFile(new event_model_1.Event(this.site.RFS_PARENT_ID, this.site.RFS_ID, 'save'));
            console.log("Save interval cleared and data saved for Flood.");
        }
    };
    HazardsSummaryComponent.prototype.getData = function () {
        this.getCategoryDropdownData();
        this.getMainTypeDropdownData();
        this.getTypeDropdownData();
    };
    HazardsSummaryComponent.prototype.getMainTypeDropdownData = function () {
        var _this = this;
        this.hazardsService.getMainTypeDropdownData().subscribe(function (data) {
            _this.mainType = data;
        }, function (err) { return console.error(err); });
    };
    HazardsSummaryComponent.prototype.getCategoryDropdownData = function () {
        var _this = this;
        this.hazardsService.getCategoryOccupancyDropdownData().subscribe(function (data) {
            _this.catOccData = data.filter(function (item) { return item.OCCUPANCY_CD == _this.occupancy_cd; });
        }, function (err) { return console.error(err); });
    };
    HazardsSummaryComponent.prototype.getOccupancyData = function () {
        var _this = this;
        this.hazardsService.getSprinklersData(this.site.RFS_PARENT_ID, this.site.RFS_ID).subscribe(function (data) {
            _this.occupancy_cd = data.AssessmentLocationList[0].LocAssessment.COPE_PAGE.OCCUPANCY_CD;
        }, function (err) { return console.error(err); });
    };
    HazardsSummaryComponent.prototype.getTypeDropdownData = function () {
        var _this = this;
        this.hazardsService.getTypeDropdownData().subscribe(function (data) {
            _this.type = data;
        }, function (err) { return console.error(err); });
    };
    HazardsSummaryComponent.prototype.setHazardsSummaryObject = function (data) {
        var _this = this;
        this.hazardsSummary = data.hazards;
        if (this.mainType) {
            for (var i = 0; i < this.hazardsSummary.length; i++) {
                var a = this.mainType.filter(function (item) { return item.Code == _this.hazardsSummary[i].HAZARD_MAIN_TYPE_CD; });
                var maintype = a.length > 0 ? a[0].Description : "";
                this.mainTypeDrop.push(maintype);
                var b = this.type.filter(function (item) { return item.Code == _this.hazardsSummary[i].HAZARD_TYPE_CD; });
                var type = b.length > 0 ? b[0].Description : "";
                this.typeDrop.push(type);
                var c = this.catOccData.filter(function (item) { return item.ELEMENT_CD == _this.hazardsSummary[i].HAZARD_CATEGORY_CD; });
                var categoryDescription = c.length > 0 ? c[0].Description : "";
                this.categoryDesc.push(categoryDescription);
            }
        }
        console.log("Summary Component Hazards Data : ", this.hazardsSummary);
    };
    HazardsSummaryComponent.prototype.deleteEstimate = function (summary, index) {
        this.hazardsSummary.splice(index, 1);
        this.mainTypeDrop.splice(index, 1);
        this.typeDrop.splice(index, 1);
        this.categoryDesc.splice(index, 1);
    };
    HazardsSummaryComponent.prototype.copyEstimate = function (summary, index) {
        var _this = this;
        this.hazardsSummary.push(summary);
        var a = this.mainType.filter(function (item) { return item.Code == _this.hazardsSummary[index].HAZARD_MAIN_TYPE_CD; });
        var maintype = a.length > 0 ? a[0].Description : "";
        this.mainTypeDrop.push(maintype);
        var b = this.type.filter(function (item) { return item.Code == _this.hazardsSummary[index].HAZARD_TYPE_CD; });
        var type = b.length > 0 ? b[0].Description : "";
        this.typeDrop.push(type);
        var c = this.catOccData.filter(function (item) { return item.ELEMENT_CD == _this.hazardsSummary[index].HAZARD_CATEGORY_CD; });
        var categoryDescription = c.length > 0 ? c[0].Description : "";
        this.categoryDesc.push(categoryDescription);
    };
    HazardsSummaryComponent.prototype.saveDataToFile = function (event) {
        var _this = this;
        var rfsParentId = this.site.RFS_PARENT_ID;
        var rfsId = this.site.RFS_ID;
        if (event.getType() == 'save' && event.getRfsParentId() == rfsParentId && event.getRfsId() == rfsId) {
            this.offlineService.readLocationData(rfsParentId, rfsId).subscribe(function (data) {
                var locData = data;
                locData.LocationAssessment.LAWorkPageList[0].
                    AssessmentLocationList[0].LocAssessment.OccupancyHazard.HazardList = _this.hazardsSummary;
                var locationDataModel = new location_data_model_1.LocationDataModel(rfsParentId, rfsId, 'hazards');
                locationDataModel.setRawData(locData);
                _this.offlineService.writeLocationData(locationDataModel);
            });
        }
    };
    HazardsSummaryComponent = __decorate([
        core_1.Component({
            moduleId: module.id,
            selector: 'hazards-summary',
            templateUrl: 'hazards-summary.component.html',
            inputs: ['viewType'],
            providers: [validationMessages_1.ValidationMessages, common_1.DatePipe, localStorageService_1.LocalStorageService, offline_service_1.OfflineService, hazards_service_1.HazardsService]
        }), 
        __metadata('design:paramtypes', [hazards_service_1.HazardsService, offline_service_1.OfflineService, componentCommunicationService_1.ComponentCommunicationService, localStorageService_1.LocalStorageService])
    ], HazardsSummaryComponent);
    return HazardsSummaryComponent;
}());
exports.HazardsSummaryComponent = HazardsSummaryComponent;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9oYXphcmRzL25ldy1oYXphcmQvaGF6YXJkcy1zdW1tYXJ5L2hhemFyZHMtc3VtbWFyeS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBLHFCQUFvRSxlQUFlLENBQUMsQ0FBQTtBQUNwRix1QkFBeUIsaUJBQWlCLENBQUMsQ0FBQTtBQUkzQyw4Q0FBOEMsK0NBQStDLENBQUMsQ0FBQTtBQUU5RixvQ0FBb0MscUNBQXFDLENBQUMsQ0FBQTtBQUMxRSxtQ0FBbUMsb0NBQW9DLENBQUMsQ0FBQTtBQUV4RSw0QkFBc0IsbUNBQW1DLENBQUMsQ0FBQTtBQUMxRCxnQ0FBK0IsMENBQTBDLENBQUMsQ0FBQTtBQUMxRSxnQ0FBK0IsOEJBQThCLENBQUMsQ0FBQTtBQUM5RCxvQ0FBa0MsMkNBQTJDLENBQUMsQ0FBQTtBQVU5RTtJQWlCRSxpQ0FBb0IsY0FBK0IsRUFBVSxjQUE4QixFQUFVLEdBQWtDLEVBQVUsbUJBQXdDO1FBQXJLLG1CQUFjLEdBQWQsY0FBYyxDQUFpQjtRQUFVLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUFVLFFBQUcsR0FBSCxHQUFHLENBQStCO1FBQVUsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQVhqTCxpQkFBWSxHQUFTLENBQUMsQ0FBQztRQUV2QixpQkFBWSxHQUFZLEVBQUUsQ0FBQztRQUUzQixhQUFRLEdBQVksRUFBRSxDQUFDO1FBS3ZCLGlCQUFZLEdBQVksRUFBRSxDQUFDO0lBS25DLENBQUM7SUFFRCwwQ0FBUSxHQUFSO1FBQUEsaUJBaUZDO1FBaEZDLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUV6RCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN4QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLElBQUksT0FBTyxDQUFDO1lBQzNDLElBQUks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QUFjLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNqRSxDQUFDLENBQ0osQ0FBQztRQUNKLENBQUM7SUFDTCxDQUFDO0lBelBIO1FBQUMsZ0JBQVMsQ0FBQztZQUNULFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixRQUFRLEVBQUUsaUJBQWlCO1lBQzNCLFdBQVcsRUFBRSxnQ0FBZ0M7WUFDN0MsTUFBTSxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ3BCLFNBQVMsRUFBRSxDQUFDLHVDQUFrQixFQUFFLGlCQUFRLEVBQUUseUNBQW1CLEVBQUUsZ0NBQWMsRUFBRSxnQ0FBYyxDQUFDO1NBQy9GLENBQUM7OytCQUFBO0lBb1BGLDhCQUFDO0FBQUQsQ0FsUEEsQUFrUEMsSUFBQTtBQWxQWSwrQkFBdUIsMEJBa1BuQyxDQUFBIiwiZmlsZSI6ImFwcC9oYXphcmRzL25ldy1oYXphcmQvaGF6YXJkcy1zdW1tYXJ5L2hhemFyZHMtc3VtbWFyeS5jb21wb25lbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT25EZXN0cm95LCBWaWV3Q2hpbGQsIEVsZW1lbnRSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgRGF0ZVBpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5cclxuaW1wb3J0IHsgTW9kYWxEaXJlY3RpdmUgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvbW9kYWwvbW9kYWwuY29tcG9uZW50JztcclxuXHJcbmltcG9ydCB7IENvbXBvbmVudENvbW11bmljYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2hhcmVkL2NvbXBvbmVudENvbW11bmljYXRpb25TZXJ2aWNlJztcclxuaW1wb3J0IHsgRHJvcGRvd25Db250YWluZXJDb21wb25lbnQgfSBmcm9tICcuLi8uLi8uLi8uLi9zaGFyZWQvZHJvcGRvd25Db250YWluZXIvZHJvcGRvd24tY29udGFpbmVyLmNvbXBvbmVudCc7XHJcbmltcG9ydCB7IExvY2FsU3RvcmFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvbG9jYWxTdG9yYWdlU2VydmljZSc7XHJcbmltcG9ydCB7IFZhbGlkYXRpb25NZXNzYWdlcyB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC92YWxpZGF0aW9uTWVzc2FnZXMnO1xyXG5pbXBvcnQgeyBTYXZlZFRvRmlsZVN5c3RlbSB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9pbnRlcmZhY2Uvc2F2ZWQtdG8tZnMuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgRXZlbnQgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvbW9kZWwvZXZlbnQubW9kZWwnO1xyXG5pbXBvcnQgeyBPZmZsaW5lU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9vZmZsaW5lLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBIYXphcmRzU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9oYXphcmRzLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBMb2NhdGlvbkRhdGFNb2RlbCB9IGZyb20gJy4uLy4uLy4uL3NoYXJlZC9tb2RlbC9sb2NhdGlvbi1kYXRhLm1vZGVsJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIG1vZHVsZUlkOiBtb2R1bGUuaWQsXHJcbiAgc2VsZWN0b3I6ICdoYXphcmRzLXN1bW1hcnknLFxyXG4gIHRlbXBsYXRlVXJsOiAnaGF6YXJkcy1zdW1tYXJ5LmNvbXBvbmVudC5odG1sJyxcclxuICBpbnB1dHM6IFsndmlld1R5cGUnXSxcclxuICBwcm92aWRlcnM6IFtWYWxpZGF0aW9uTWVzc2FnZXMsIERhdGVQaXBlLCBMb2NhbFN0b3JhZ2VTZXJ2aWNlLCBPZmZsaW5lU2VydmljZSwgSGF6YXJkc1NlcnZpY2VdXHJcbn0pXHJcblxyXG5leHBvcnQgY2xhc3MgSGF6YXJkc1N1bW1hcnlDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgU2F2ZWRUb0ZpbGVTeXN0ZW0ge1xyXG4gIC8vQGlucHV0XHJcbiAgcHJpdmF0ZSBoYXphcmRBZGREYXRhT2JqOiBhbnk7XHJcbiAgcHJpdmF0ZSBzYXZlSW50ZXJ2YWw6IGFueTsgIFxyXG4gIHByaXZhdGUgc2l0ZTogYW55O1xyXG4gIHByaXZhdGUgaGF6YXJkc1N1bW1hcnk6IGFueTtcclxuICBwcml2YXRlIG9jY3VwYW5jeV9jZCA6IGFueSA9IDI7IFxyXG4gIHByaXZhdGUgbWFpblR5cGUgOiBhbnk7XHJcbiAgcHJpdmF0ZSBtYWluVHlwZURyb3AgOiBhbnkgW10gPSBbXTtcclxuICBwcml2YXRlIHR5cGUgOiBhbnk7XHJcbiAgcHJpdmF0ZSB0eXBlRHJvcCA6IGFueSBbXSA9IFtdO1xyXG4gIHByaXZhdGUgaGF6YXJkQ2xhc3MgOiBhbnk7XHJcbiAgcHJpdmF0ZSBjYXRPY2NEYXRhIDogYW55OyBcclxuICBwcml2YXRlIHByZWRvbWluYW50Q29tbW9kaXR5Q2xhc3MgOiBhbnk7XHJcbiAgcHJpdmF0ZSBzdG9yYWdlQXJyYW5nZW1lbnQgOiBhbnk7XHJcbiAgcHJpdmF0ZSBjYXRlZ29yeURlc2MgOiBhbnkgW10gPSBbXTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBoYXphcmRzU2VydmljZSA6IEhhemFyZHNTZXJ2aWNlLCBwcml2YXRlIG9mZmxpbmVTZXJ2aWNlOiBPZmZsaW5lU2VydmljZSwgcHJpdmF0ZSBjY3M6IENvbXBvbmVudENvbW11bmljYXRpb25TZXJ2aWNlLCBwcml2YXRlIGxvY2FsU3RvcmFnZVNlcnZpY2U6IExvY2FsU3RvcmFnZVNlcnZpY2UpXHJcbiAge1xyXG5cclxuICB9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5zaXRlID0gdGhpcy5sb2NhbFN0b3JhZ2VTZXJ2aWNlLmdldCgnbG9jYXRpb25EYXRhJyk7XHJcbiAgICAvLyB0aGlzLm9jY3VwYW5jeV9jZCA9IHRoaXMubG9jYWxTdG9yYWdlU2VydmljZS5nZXQoJ29jY3VwYW5jeV9jb2RlJyk7XHJcbiAgICB0aGlzLmdldE9jY3VwYW5jeURhdGEoKTtcclxuICAgIGlmKHRoaXMudmlld1R5cGUgJiYgdGhpcy52aWV3VHlwZSA9PSAnc21hbGwnKVxyXG4gICAgICB0aGlzLmhhemFyZHNTdW1tYXJ5U21hbGxWaWV3ID0gdHJ1ZTtcclxuICAgICAgLy8gdGhpcyBjb21wb25lbnQgd2lsbCByZWFkIHRoZSBkYXRhIGZyb20gb2ZmbGluZSBzZXJ2aWNlIGFuZCByZW5kZXIgdGhlIHN1bW1hcnkgc2NyZWVuLlxyXG4gICAgICB0aGlzLmdldERhdGEoKTsgXHJcbiAgICAgIHRoaXMuY2NzLmdldEhhemFyZEFkZERhdGEoKS5zdWJzY3JpYmUoZGF0YSA9PiB7XHJcbiAgICAgICAgaWYoZGF0YS5zdGF0ZSA9PSBcIk5ld1wiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRoaXMuY2F0ZWdvcnlEZXNjID0gW107XHJcbiAgICAgICAgICB0aGlzLm1haW5UeXBlRHJvcCA9IFtdO1xyXG4gICAgICAgICAgdGhpcy50eXBlRHJvcCA9IFtdO1xyXG4gICAgICAgICAgdGhpcy5oYXphcmRBZGREYXRhT2JqID0gZGF0YS5oYXphcmRPYmo7ICAgICAgICAgIFxyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeS5wdXNoKHRoaXMuaGF6YXJkQWRkRGF0YU9iaik7XHJcblxyXG4gICAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuaGF6YXJkc1N1bW1hcnkubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldCBhID0gdGhpcy5tYWluVHlwZS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gdGhpcy5oYXphcmRzU3VtbWFyeVtpXS5IQVpBUkRfTUFJTl9UWVBFX0NEKTtcclxuICAgICAgICAgICAgbGV0IG1haW50eXBlID0gYS5sZW5ndGggPiAwID8gYVswXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICAgIHRoaXMubWFpblR5cGVEcm9wLnB1c2gobWFpbnR5cGUpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuaGF6YXJkc1N1bW1hcnkubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICB7XHJcblxyXG4gICAgICAgICAgICBsZXQgYiA9IHRoaXMudHlwZS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gdGhpcy5oYXphcmRzU3VtbWFyeVtpXS5IQVpBUkRfVFlQRV9DRCk7XHJcbiAgICAgICAgICAgIGxldCB0eXBlID0gYi5sZW5ndGggPiAwID8gYlswXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICAgIHRoaXMudHlwZURyb3AucHVzaCh0eXBlKTtcclxuICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuaGF6YXJkc1N1bW1hcnkubGVuZ3RoOyBpKyspXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGxldCBjID0gdGhpcy5jYXRPY2NEYXRhLmZpbHRlcihpdGVtID0+IGl0ZW0uRUxFTUVOVF9DRCA9PSB0aGlzLmhhemFyZHNTdW1tYXJ5W2ldLkhBWkFSRF9DQVRFR09SWV9DRCk7XHJcbiAgICAgICAgICAgIGxldCBjYXRlZ29yeURlc2NyaXB0aW9uID0gYy5sZW5ndGggPiAwID8gY1swXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICAgIHRoaXMuY2F0ZWdvcnlEZXNjLnB1c2goY2F0ZWdvcnlEZXNjcmlwdGlvbik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICBkYXRhLnN0YXRlID0gXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZGF0YS5zdGF0ZSA9PSBcIlVwZGF0ZVwiKVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIC8qdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5IQVpBUkRfTUFJTl9UWVBFX0NEID0gZGF0YS5oYXphcmRPYmouSEFaQVJEX01BSU5fVFlQRV9DRDtcclxuICAgICAgICAgIHRoaXMuaGF6YXJkc1N1bW1hcnlbZGF0YS5pbmRleF0uSEFaQVJEX1RZUEVfQ0QgPSBkYXRhLmhhemFyZE9iai5IQVpBUkRfVFlQRV9DRDtcclxuICAgICAgICAgIHRoaXMuaGF6YXJkc1N1bW1hcnlbZGF0YS5pbmRleF0uSEFaQVJEX0NBVEVHT1JZX0NEID0gZGF0YS5oYXphcmRPYmouSEFaQVJEX0NBVEVHT1JZX0NEO1xyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5IQVpBUkRfQ0xBU1NfQ0QgPSBkYXRhLmhhemFyZE9iai5IQVpBUkRfQ0xBU1NfQ0Q7XHJcbiAgICAgICAgICB0aGlzLmhhemFyZHNTdW1tYXJ5W2RhdGEuaW5kZXhdLlNUT1JBR0VfQVJSQU5HRU1FTlRfQ0QgPSBkYXRhLmhhemFyZE9iai5TVE9SQUdFX0FSUkFOR0VNRU5UX0NEO1xyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5QUkVET01JTkFOVF9DTEFTU19DRCA9IGRhdGEuaGF6YXJkT2JqLlBSRURPTUlOQU5UX0NMQVNTX0NEO1xyXG5cclxuICAgICAgICAgIHRoaXMuaGF6YXJkc1N1bW1hcnlbZGF0YS5pbmRleF0uU1BFQ0lGSUNfTE9DQVRJT05fTk0gPSBkYXRhLmhhemFyZE9iai5TUEVDSUZJQ19MT0NBVElPTl9OTTtcclxuICAgICAgICAgIHRoaXMuaGF6YXJkc1N1bW1hcnlbZGF0YS5pbmRleF0uSEFaQVJEX0FSRUFfU0laRV9RVCA9IGRhdGEuaGF6YXJkT2JqLkhBWkFSRF9BUkVBX1NJWkVfUVQ7XHJcbiAgICAgICAgICB0aGlzLmhhemFyZHNTdW1tYXJ5W2RhdGEuaW5kZXhdLlNUT1JBR0VfSEVJR0hUX1FUID0gZGF0YS5oYXphcmRPYmouU1RPUkFHRV9IRUlHSFRfUVQ7IFxyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5DRUlMSU5HX0hFSUdIVF9RVCA9IGRhdGEuaGF6YXJkT2JqLkNFSUxJTkdfSEVJR0hUX1FUO1xyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5IYXphcmRDb21tZW50c1swXS5QcmltYXJ5TGFuZ3VhZ2UgPSBkYXRhLmhhemFyZE9iai5IYXphcmRDb21tZW50c1swXS5QcmltYXJ5TGFuZ3VhZ2UgPyBkYXRhLmhhemFyZE9iai5IYXphcmRDb21tZW50c1swXS5QcmltYXJ5TGFuZ3VhZ2UgOiBcIlwiOyAgICAgICAgICBcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5zcHJpbmtsZXJzID0gZGF0YS5oYXphcmRPYmouc3ByaW5rbGVyczsqL1xyXG4gICAgICAgICAgdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XSA9IGRhdGEuaGF6YXJkT2JqO1xyXG5cclxuICAgICAgICAgIGxldCBhID0gdGhpcy5tYWluVHlwZS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5IQVpBUkRfTUFJTl9UWVBFX0NEKTtcclxuICAgICAgICAgIGxldCBtYWludHlwZSA9IGEubGVuZ3RoID4gMCA/IGFbMF0uRGVzY3JpcHRpb24gOiBcIlwiO1xyXG4gICAgICAgICAgdGhpcy5tYWluVHlwZURyb3BbZGF0YS5pbmRleF0gPSBtYWludHlwZTtcclxuXHJcbiAgICAgICAgICBsZXQgYiA9IHRoaXMudHlwZS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gdGhpcy5oYXphcmRzU3VtbWFyeVtkYXRhLmluZGV4XS5IQVpBUkRfVFlQRV9DRCk7XHJcbiAgICAgICAgICBsZXQgdHlwZSA9IGIubGVuZ3RoID4gMCA/IGJbMF0uRGVzY3JpcHRpb24gOiBcIlwiO1xyXG4gICAgICAgICAgdGhpcy50eXBlRHJvcFtkYXRhLmluZGV4XSA9IHR5cGU7XHJcblxyXG4gICAgICAgICAgbGV0IGMgPSB0aGlzLmNhdE9jY0RhdGEuZmlsdGVyKGl0ZW0gPT4gaXRlbS5FTEVNRU5UX0NEID09IHRoaXMuaGF6YXJkc1N1bW1hcnlbZGF0YS5pbmRleF0uSEFaQVJEX0NBVEVHT1JZX0NEKTtcclxuICAgICAgICAgIGxldCBjYXRlZ29yeURlc2NyaXB0aW9uID0gYy5sZW5ndGggPiAwID8gY1swXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgICB0aGlzLmNhdGVnb3J5RGVzY1tkYXRhLmluZGV4XSA9IGNhdGVnb3J5RGVzY3JpcHRpb247IFxyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBkYXRhLnN0YXRlID0gXCJcIjtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIHRoaXMuY2NzLmdldEhhemFyZHNEYXRhKCkuc3Vic2NyaWJlKGRhdGEgPT4ge1xyXG4gICAgICAgIHRoaXMuc2V0SGF6YXJkc1N1bW1hcnlPYmplY3QoZGF0YSk7XHJcbiAgICB9KTtcclxuICAgIHRoaXMuc2F2ZUludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4geyAgICAgIFxyXG4gICAgICBjb25zb2xlLmxvZyhcIlJlcXVlc3Rpbmcgd2luZCBwZXJpbCB0byBzYXZlIGZvciByZnMgcGFyZW50OlwiLCB0aGlzLnNpdGUuUkZTX1BBUkVOVF9JRCwgXCJhbmQgcmZzOlwiLCB0aGlzLnNpdGUuUkZTX0lEKTtcclxuICAgICAgdGhpcy5zYXZlRGF0YVRvRmlsZShuZXcgRXZlbnQodGhpcy5zaXRlLlJGU19QQVJFTlRfSUQsIHRoaXMuc2l0ZS5SRlNfSUQsICdzYXZlJykpO1xyXG4gICAgfSwgMzAwMDApO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKVxyXG4gIHtcclxuICAgICAgaWYgKHRoaXMuc2F2ZUludGVydmFsKVxyXG4gICAgICB7XHJcbiAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuc2F2ZUludGVydmFsKTtcclxuICAgICAgICAgIHRoaXMuc2F2ZURhdGFUb0ZpbGUobmV3IEV2ZW50KHRoaXMuc2l0ZS5SRlNfUEFSRU5UX0lELCB0aGlzLnNpdGUuUkZTX0lELCAnc2F2ZScpKTtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKGBTYXZlIGludGVydmFsIGNsZWFyZWQgYW5kIGRhdGEgc2F2ZWQgZm9yIEZsb29kLmApOyBcclxuICAgICAgfVxyXG4gIH1cclxuXHJcbiAgZ2V0RGF0YSgpXHJcbiAge1xyXG4gICAgdGhpcy5nZXRDYXRlZ29yeURyb3Bkb3duRGF0YSgpO1xyXG4gICAgdGhpcy5nZXRNYWluVHlwZURyb3Bkb3duRGF0YSgpO1xyXG4gICAgdGhpcy5nZXRUeXBlRHJvcGRvd25EYXRhKCk7XHJcbiAgfVxyXG5cclxuICBnZXRNYWluVHlwZURyb3Bkb3duRGF0YSgpXHJcbiAge1xyXG4gICAgdGhpcy5oYXphcmRzU2VydmljZS5nZXRNYWluVHlwZURyb3Bkb3duRGF0YSgpLnN1YnNjcmliZShcclxuICAgICAgICBkYXRhID0+XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGhpcy5tYWluVHlwZSA9IGRhdGE7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAgIGVyciA9PiBjb25zb2xlLmVycm9yKGVycilcclxuICAgICAgICApO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q2F0ZWdvcnlEcm9wZG93bkRhdGEoKVxyXG4gIHtcclxuICAgLy9pZighdGhpcy5vY2N1cGFuY3lfY2QpIHRoaXMuZ2V0T2NjdXBhbmN5RGF0YSgpO1xyXG4gICAgdGhpcy5oYXphcmRzU2VydmljZS5nZXRDYXRlZ29yeU9jY3VwYW5jeURyb3Bkb3duRGF0YSgpLnN1YnNjcmliZShcclxuICAgICAgICBkYXRhID0+XHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdGhpcy5jYXRPY2NEYXRhID0gIGRhdGEuZmlsdGVyKGl0ZW0gPT4gaXRlbS5PQ0NVUEFOQ1lfQ0QgPT0gdGhpcy5vY2N1cGFuY3lfY2QpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgICBlcnIgPT4gY29uc29sZS5lcnJvcihlcnIpXHJcbiAgICAgICAgKTtcclxuICB9XHJcbiAgICAvL29jY3VwYW5jeVxyXG4gICAgZ2V0T2NjdXBhbmN5RGF0YSgpIHsgICAgICBcclxuICAgICAgdGhpcy5oYXphcmRzU2VydmljZS5nZXRTcHJpbmtsZXJzRGF0YSh0aGlzLnNpdGUuUkZTX1BBUkVOVF9JRCwgdGhpcy5zaXRlLlJGU19JRCkuc3Vic2NyaWJlKFxyXG4gICAgICAgICAgICBkYXRhID0+IHsgXHJcbiAgICAgICAgICAgICAgdGhpcy5vY2N1cGFuY3lfY2QgPSBkYXRhLkFzc2Vzc21lbnRMb2NhdGlvbkxpc3RbMF0uTG9jQXNzZXNzbWVudC5DT1BFX1BBR0UuT0NDVVBBTkNZX0NEOyBcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyID0+IGNvbnNvbGUuZXJyb3IoZXJyKS8vLFxyXG4gICAgICAgICAgICAvLygpID0+IHRoaXMuc3ByaW5rbGVyc0RhdGFIYW5kbGVyKHJlc3BvbnNlKVxyXG4gICAgICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRUeXBlRHJvcGRvd25EYXRhKClcclxuICB7XHJcbiAgICB0aGlzLmhhemFyZHNTZXJ2aWNlLmdldFR5cGVEcm9wZG93bkRhdGEoKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgZGF0YSA9PlxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHRoaXMudHlwZSA9IGRhdGE7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAgIGVyciA9PiBjb25zb2xlLmVycm9yKGVycilcclxuICAgICAgICApO1xyXG4gIH1cclxuXHJcbiAgc2V0SGF6YXJkc1N1bW1hcnlPYmplY3QoZGF0YSlcclxuICB7IFxyXG4gICAgdGhpcy5oYXphcmRzU3VtbWFyeSA9IGRhdGEuaGF6YXJkcztcclxuICAgIGlmICh0aGlzLm1haW5UeXBlKVxyXG4gICAgeyBcclxuICAgICAgZm9yICh2YXIgaT0wOyBpPHRoaXMuaGF6YXJkc1N1bW1hcnkubGVuZ3RoOyBpKyspXHJcbiAgICAgIHtcclxuICAgICAgICBsZXQgYSA9IHRoaXMubWFpblR5cGUuZmlsdGVyKGl0ZW0gPT4gaXRlbS5Db2RlID09IHRoaXMuaGF6YXJkc1N1bW1hcnlbaV0uSEFaQVJEX01BSU5fVFlQRV9DRCk7XHJcbiAgICAgICAgbGV0IG1haW50eXBlID0gYS5sZW5ndGggPiAwID8gYVswXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICAgICAgdGhpcy5tYWluVHlwZURyb3AucHVzaChtYWludHlwZSk7XHJcblxyXG4gICAgICAgIGxldCBiID0gdGhpcy50eXBlLmZpbHRlcihpdGVtID0+IGl0ZW0uQ29kZSA9PSB0aGlzLmhhemFyZHNTdW1tYXJ5W2ldLkhBWkFSRF9UWVBFX0NEKTtcclxuICAgICAgICBsZXQgdHlwZSA9IGIubGVuZ3RoID4gMCA/IGJbMF0uRGVzY3JpcHRpb24gOiBcIlwiO1xyXG4gICAgICAgIHRoaXMudHlwZURyb3AucHVzaCh0eXBlKTtcclxuXHJcbiAgICAgICAgbGV0IGMgPSB0aGlzLmNhdE9jY0RhdGEuZmlsdGVyKGl0ZW0gPT4gaXRlbS5FTEVNRU5UX0NEID09IHRoaXMuaGF6YXJkc1N1bW1hcnlbaV0uSEFaQVJEX0NBVEVHT1JZX0NEKTtcclxuICAgICAgICBsZXQgY2F0ZWdvcnlEZXNjcmlwdGlvbiA9IGMubGVuZ3RoID4gMCA/IGNbMF0uRGVzY3JpcHRpb24gOiBcIlwiO1xyXG4gICAgICAgIHRoaXMuY2F0ZWdvcnlEZXNjLnB1c2goY2F0ZWdvcnlEZXNjcmlwdGlvbik7XHJcbiAgICAgIH1cclxuICB9XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU3VtbWFyeSBDb21wb25lbnQgSGF6YXJkcyBEYXRhIDogXCIsIHRoaXMuaGF6YXJkc1N1bW1hcnkpO1xyXG4gIH1cclxuXHJcbiAgZGVsZXRlRXN0aW1hdGUoc3VtbWFyeSwgaW5kZXgpXHJcbiAge1xyXG4gICAgdGhpcy5oYXphcmRzU3VtbWFyeS5zcGxpY2UoaW5kZXgsMSk7XHJcbiAgICB0aGlzLm1haW5UeXBlRHJvcC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgdGhpcy50eXBlRHJvcC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgdGhpcy5jYXRlZ29yeURlc2Muc3BsaWNlKGluZGV4LCAxKTtcclxuICB9XHJcblxyXG4gIGNvcHlFc3RpbWF0ZShzdW1tYXJ5LCBpbmRleClcclxuICB7XHJcbiAgICB0aGlzLmhhemFyZHNTdW1tYXJ5LnB1c2goc3VtbWFyeSk7XHJcblxyXG4gICAgbGV0IGEgPSB0aGlzLm1haW5UeXBlLmZpbHRlcihpdGVtID0+IGl0ZW0uQ29kZSA9PSB0aGlzLmhhemFyZHNTdW1tYXJ5W2luZGV4XS5IQVpBUkRfTUFJTl9UWVBFX0NEKTtcclxuICAgIGxldCBtYWludHlwZSA9IGEubGVuZ3RoID4gMCA/IGFbMF0uRGVzY3JpcHRpb24gOiBcIlwiO1xyXG4gICAgdGhpcy5tYWluVHlwZURyb3AucHVzaChtYWludHlwZSk7XHJcbiAgICBcclxuXHJcbiAgICBsZXQgYiA9IHRoaXMudHlwZS5maWx0ZXIoaXRlbSA9PiBpdGVtLkNvZGUgPT0gdGhpcy5oYXphcmRzU3VtbWFyeVtpbmRleF0uSEFaQVJEX1RZUEVfQ0QpO1xyXG4gICAgbGV0IHR5cGUgPSBiLmxlbmd0aCA+IDAgPyBiWzBdLkRlc2NyaXB0aW9uIDogXCJcIjtcclxuICAgIHRoaXMudHlwZURyb3AucHVzaCh0eXBlKTtcclxuXHJcbiAgICBcclxuXHJcbiAgICBsZXQgYyA9IHRoaXMuY2F0T2NjRGF0YS5maWx0ZXIoaXRlbSA9PiBpdGVtLkVMRU1FTlRfQ0QgPT0gdGhpcy5oYXphcmRzU3VtbWFyeVtpbmRleF0uSEFaQVJEX0NBVEVHT1JZX0NEKTtcclxuICAgIGxldCBjYXRlZ29yeURlc2NyaXB0aW9uID0gYy5sZW5ndGggPiAwID8gY1swXS5EZXNjcmlwdGlvbiA6IFwiXCI7XHJcbiAgICB0aGlzLmNhdGVnb3J5RGVzYy5wdXNoKGNhdGVnb3J5RGVzY3JpcHRpb24pOyBcclxuIFxyXG4gICAgXHJcblxyXG4gIH1cclxuXHJcblxyXG5cclxuICBzYXZlRGF0YVRvRmlsZShldmVudClcclxuICB7XHJcbiAgICAgIGxldCByZnNQYXJlbnRJZCA9IHRoaXMuc2l0ZS5SRlNfUEFSRU5UX0lEO1xyXG4gICAgICBsZXQgcmZzSWQgPSB0aGlzLnNpdGUuUkZTX0lEO1xyXG4gICAgICBpZiAoZXZlbnQuZ2V0VHlwZSgpID09ICdzYXZlJyAmJiBldmVudC5nZXRSZnNQYXJlbnRJZCgpID09IHJmc1BhcmVudElkICYmIGV2ZW50LmdldFJmc0lkKCkgPT0gcmZzSWQpXHJcbiAgICAgIHtcclxuICAgICAgICAgICB0aGlzLm9mZmxpbmVTZXJ2aWNlLnJlYWRMb2NhdGlvbkRhdGEocmZzUGFyZW50SWQsIHJmc0lkKS5zdWJzY3JpYmUoXHJcbiAgICAgICAgICAgIGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGxvY0RhdGEgPSBkYXRhOyAgICAgICAgICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxvY0RhdGEuTG9jYXRpb25Bc3Nlc3NtZW50LkxBV29ya1BhZ2VMaXN0WzBdLlxyXG4gICAgICAgICAgICAgICAgICAgIEFzc2Vzc21lbnRMb2NhdGlvbkxpc3RbMF0uTG9jQXNzZXNzbWVudC5PY2N1cGFuY3lIYXphcmQuSGF6YXJkTGlzdCA9IHRoaXMuaGF6YXJkc1N1bW1hcnk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxvY2F0aW9uRGF0YU1vZGVsID0gbmV3IExvY2F0aW9uRGF0YU1vZGVsKHJmc1BhcmVudElkLCByZnNJZCwgJ2hhemFyZHMnKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbkRhdGFNb2RlbC5zZXRSYXdEYXRhKGxvY0RhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub2ZmbGluZVNlcnZpY2Uud3JpdGVMb2NhdGlvbkRhdGEobG9jYXRpb25EYXRhTW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gIH1cclxufVxyXG4iXX0=
